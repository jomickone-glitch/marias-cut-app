<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Maria's Cut</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F9F7F2">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="778405F5-FB9C-47F4-908A-185070ECD1DC.PNG">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#C5A059',
                        primaryDark: '#A88B45',
                        secondary: '#D4B896',
                        secondaryDark: '#B89C7A',
                        background: '#F9F7F2',
                        gold: '#D4AF37',
                        goldLight: '#E8D5A3',
                    },
                    fontFamily: {
                        sans: ['Quicksand', 'Poppins', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%;
            height: 100dvh;
            overflow: hidden;
            font-family: 'Quicksand', 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F9F7F2;
        }

        #app-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            background: #F9F7F2;
        }

        .safe-header {
            padding-top: calc(env(safe-area-inset-top, 0px) + 10px);
            padding-bottom: 12px;
            background: #FFFDF5;
            border-bottom: 1px solid rgba(197, 160, 89, 0.15);
            position: sticky;
            top: 0;
            z-index: 50;
            flex-shrink: 0;
        }

        .header-gradient {
            background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%);
            padding-top: calc(env(safe-area-inset-top, 0px) + 12px);
            padding-bottom: 8px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .screen {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            background: #F9F7F2;
            overflow: hidden;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .screen.hidden {
            transform: translateX(100%);
            opacity: 0;
            pointer-events: none;
        }

        .screen-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 100px);
        }

        /* ========== LOGIN STYLES ========== */
        .login-screen {
            background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%);
            justify-content: center;
            padding: 24px;
        }

        .login-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #D4AF37 0%, #C5A059 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            box-shadow: 0 8px 32px rgba(212, 175, 55, 0.4);
        }

        .login-input {
            width: 100%;
            padding: 16px 20px;
            border-radius: 16px;
            border: 2px solid rgba(197, 160, 89, 0.3);
            background: white;
            font-size: 1rem;
            margin-bottom: 12px;
            outline: none;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            border-color: #C5A059;
            box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.15);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            border-radius: 50px;
            background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%);
            color: white;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(197, 160, 89, 0.4);
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(197, 160, 89, 0.5);
        }

        .login-btn-secondary {
            width: 100%;
            padding: 14px;
            border-radius: 50px;
            background: transparent;
            color: #4B3621;
            font-weight: 500;
            font-size: 0.95rem;
            border: 2px solid rgba(197, 160, 89, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 12px;
        }

        .login-btn-secondary:hover {
            background: rgba(197, 160, 89, 0.1);
        }

        /* ========== NUEVA BARRA DE NAVEGACI√ìN CON BOT√ìN CENTRAL ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #FFFDF5;
            border-top: 1px solid rgba(197, 160, 89, 0.2);
            padding-bottom: env(safe-area-inset-bottom, 0px);
            z-index: 100;
            height: 80px;
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            padding-top: 8px;
            position: relative;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            transition: color 0.2s ease;
            flex: 1;
        }

        .nav-item.active { color: #C5A059; }
        .nav-item:not(.active) { color: #8B7355; }

        /* BOT√ìN CENTRAL DESTACADO - PELUQUER√çA */
        .nav-center-btn {
            position: relative;
            top: -28px;
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: linear-gradient(135deg, #D4AF37 0%, #C5A059 50%, #B8941F 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(212, 175, 55, 0.5), 
                        0 4px 16px rgba(197, 160, 89, 0.4),
                        inset 0 2px 4px rgba(255, 255, 255, 0.3);
            border: 3px solid #FFFDF5;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
            z-index: 10;
        }

        .nav-center-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 12px 40px rgba(212, 175, 55, 0.6), 
                        0 6px 20px rgba(197, 160, 89, 0.5);
        }

        .nav-center-btn:active {
            transform: translateY(-2px) scale(0.98);
        }

        .nav-center-btn.active {
            background: linear-gradient(135deg, #B8941F 0%, #A88B45 50%, #9A7D1A 100%);
            box-shadow: 0 6px 24px rgba(184, 148, 31, 0.6), 
                        inset 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .nav-center-label {
            position: absolute;
            bottom: -22px;
            font-size: 0.7rem;
            font-weight: 600;
            color: #C5A059;
            white-space: nowrap;
        }

        /* Social Feed Styles */
        .stories-rail {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 12px 16px;
            background: #FFFDF5;
            border-bottom: 1px solid rgba(197, 160, 89, 0.1);
        }

        .stories-rail::-webkit-scrollbar { display: none; }

        .story-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
            cursor: pointer;
        }

        .story-avatar-ring {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            padding: 3px;
            background: linear-gradient(45deg, #F0EAD6, #C5A059, #D4B896);
        }

        .story-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid #FFFDF5;
            object-fit: cover;
        }

        .social-card {
            background: #FFFDF5;
            border-radius: 24px;
            margin: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(75, 54, 33, 0.06);
        }

        .post-media {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
        }

        /* Chat Styles */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 0.95rem;
            line-height: 1.4;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-bubble.bot {
            align-self: flex-start;
            background: #FFFDF5;
            color: #4B3621;
            border: 1px solid rgba(197, 160, 89, 0.2);
            border-bottom-left-radius: 4px;
        }

        .chat-bubble.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-input-area {
            padding: 12px 16px calc(env(safe-area-inset-bottom, 0px) + 80px);
            background: #FFFDF5;
            border-top: 1px solid rgba(197, 160, 89, 0.15);
        }

        .chat-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #F9F7F2;
            border-radius: 50px;
            padding: 4px 4px 4px 16px;
            border: 1px solid rgba(197, 160, 89, 0.2);
        }

        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 0.95rem;
            color: #4B3621;
            outline: none;
            padding: 10px 0;
        }

        .chat-input::placeholder { color: #8B7355; }

        .chat-send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Shop Styles */
        .product-card {
            background: #FFFDF5;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(75, 54, 33, 0.05);
        }

        .category-pill {
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .category-pill.active {
            background: #C5A059;
            color: white;
        }

        .category-pill:not(.active) {
            background: #FFFDF5;
            color: #6D5D4E;
            border: 1px solid rgba(197, 160, 89, 0.2);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* ========== ESTILOS PANTALLA PELUQUER√çA ========== */
        .grooming-header {
            background: linear-gradient(135deg, #FFFDF5 0%, #F5EFE0 100%);
            border-bottom: 1px solid rgba(197, 160, 89, 0.2);
        }

        .announcement-card {
            background: #FFFDF5;
            border: 1px solid rgba(197, 160, 89, 0.25);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .announcement-card:hover {
            border-color: rgba(197, 160, 89, 0.5);
            box-shadow: 0 4px 16px rgba(197, 160, 89, 0.1);
        }

        .portfolio-ring {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            padding: 3px;
            background: linear-gradient(135deg, #D4AF37, #C5A059, #D4B896);
        }

        .portfolio-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid #FFFDF5;
            object-fit: cover;
        }

        .cta-button {
            background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(197, 160, 89, 0.4);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(197, 160, 89, 0.5);
        }

        .cta-button-gold {
            background: linear-gradient(135deg, #D4AF37 0%, #C5A059 50%, #B8941F 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.1rem;
            box-shadow: 0 8px 32px rgba(212, 175, 55, 0.5);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            width: 100%;
        }

        .cta-button-gold:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(212, 175, 55, 0.6);
        }

        /* ========== ESTILOS M√ìDULO RESERVAS ========== */
        .service-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 24px !important;
            background: #F0EAD6 !important;
            border: 1px solid rgba(197, 160, 89, 0.25) !important;
        }

        .service-card:active {
            transform: scale(0.98);
            box-shadow: 0 4px 15px rgba(75, 54, 33, 0.1);
        }

        .btn-ripple {
            position: relative;
            overflow: hidden;
            border-radius: 50px !important;
        }

        .btn-ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(230, 200, 139, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .btn-ripple:active::after {
            width: 300px;
            height: 300px;
        }

        .input-field {
            transition: all 0.3s ease;
            border-radius: 16px !important;
            background: #FFFDF5 !important;
            border: 2px solid rgba(197, 160, 89, 0.25) !important;
        }

        .input-field:focus {
            border-color: #C5A059 !important;
            box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.15) !important;
        }

        @keyframes checkmark {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .check-animation {
            animation: checkmark 0.5s ease-out;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #F0EAD6;
            border-top: 4px solid #C5A059;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Perfil Styles */
        .profile-header {
            background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%);
            padding-top: calc(env(safe-area-inset-top, 0px) + 20px);
            padding-bottom: 30px;
        }

        /* Action Sheet */
        .action-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 24px 24px 0 0;
            padding: 20px;
            z-index: 200;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .action-sheet.open {
            transform: translateY(0);
        }

        .action-sheet-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 199;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .action-sheet-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }

        .action-item {
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid rgba(197, 160, 89, 0.2);
            cursor: pointer;
            font-weight: 500;
        }

        .action-item:last-child {
            border-bottom: none;
        }

        .action-item.danger {
            color: #ef4444;
        }

        /* Upload Progress */
        .upload-progress {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 24px 32px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 300;
            text-align: center;
        }

        .upload-progress.hidden {
            display: none;
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: #F0EAD6;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- ============================================================ -->
        <!-- SCREEN: LOGIN (mc-login) -->
        <!-- ============================================================ -->
        <div id="mc-login" class="screen login-screen">
            <div class="text-center mb-8">
                <div class="login-logo">
                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"/>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-[#4B3621] font-serif mb-2">Maria's Cut</h1>
                <p class="text-[#6D5D4E]">Peluquer√≠a Canina Premium</p>
            </div>

            <div class="max-w-sm mx-auto w-full">
                <input type="text" id="login-name" class="login-input" placeholder="Tu nombre">
                <input type="email" id="login-email" class="login-input" placeholder="Correo electr√≥nico">
                <input type="password" id="login-password" class="login-input" placeholder="Contrase√±a">
                <input type="text" id="login-pet" class="login-input" placeholder="Nombre de tu mascota">
                <input type="tel" id="login-phone" class="login-input" placeholder="Tel√©fono">
                
                <button onclick="handleLogin()" class="login-btn">Entrar / Registrar</button>
                <button onclick="handleSkip()" class="login-btn-secondary">Omitir (Modo Invitado)</button>
                
                <p id="login-error" class="text-red-500 text-sm text-center mt-4 hidden"></p>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- SCREEN: PROFILE PHOTO (mc-profile-photo) -->
        <!-- ============================================================ -->
        <div id="mc-profile-photo" class="screen hidden" style="background: #F9F7F2;">
            <div class="flex-1 flex flex-col items-center justify-center px-6">
                <h2 class="text-2xl font-bold text-[#4B3621] mb-2">¬°Una foto de perfil!</h2>
                <p class="text-[#6D5D4E] mb-8 text-center">Sube una foto de tu mascota para personalizar tu perfil</p>
                
                <div class="relative mb-8">
                    <div id="photo-preview" class="w-40 h-40 rounded-full bg-[#F0EAD6] flex items-center justify-center border-4 border-[#C5A059] overflow-hidden">
                        <svg class="w-16 h-16 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <button onclick="document.getElementById('profile-photo-input').click()" class="absolute bottom-0 right-0 w-12 h-12 bg-[#C5A059] rounded-full flex items-center justify-center shadow-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                </div>
                
                <input type="file" id="profile-photo-input" class="hidden" accept="image/*" onchange="handleProfilePhotoSelect(event)">
                
                <button onclick="saveProfilePhoto()" id="save-photo-btn" class="login-btn max-w-xs" disabled>Continuar</button>
                <button onclick="skipProfilePhoto()" class="login-btn-secondary max-w-xs mt-3">Saltar por ahora</button>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- SCREEN: HOME (SOCIAL CLUB) -->
        <!-- ============================================================ -->
        <div id="screen-home" class="screen hidden">
            <div class="header-gradient px-4 flex justify-between items-center">
                <div>
                    <h1 class="text-lg font-bold text-[#4B3621]">Maria's Social Club</h1>
                    <p class="text-xs text-[#C5A059] font-medium">Comunidad Exclusiva</p>
                </div>
                <div class="w-9 h-9 bg-white/50 rounded-full flex items-center justify-center cursor-pointer" onclick="showActionSheet()">
                    <svg class="w-5 h-5 text-[#4B3621]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                </div>
            </div>

            <div class="screen-content">
                <div class="stories-rail" id="stories-container">
                    <div class="story-item" onclick="document.getElementById('story-input').click()">
                        <div class="story-avatar-ring" style="background: transparent; border: 2px dashed #C5A059;">
                            <div class="w-full h-full bg-white rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                            </div>
                        </div>
                        <span class="text-xs text-[#6D5D4E] mt-1">Tu Historia</span>
                    </div>
                    <!-- Stories se cargar√°n din√°micamente -->
                </div>

                <div id="feed-container"></div>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- SCREEN: SHOP (BOUTIQUE) -->
        <!-- ============================================================ -->
        <div id="screen-shop" class="screen hidden">
            <div class="safe-header px-4 flex justify-between items-center">
                <h1 class="text-lg font-bold text-[#4B3621]">Boutique Maria's Cut</h1>
                <div class="relative">
                    <svg class="w-6 h-6 text-[#4B3621]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                    </svg>
                    <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-[10px] rounded-full flex items-center justify-center font-bold">2</span>
                </div>
            </div>

            <div class="screen-content">
                <div class="px-4 py-3">
                    <div class="relative">
                        <input type="text" placeholder="Buscar productos..." class="w-full bg-[#FFFDF5] border border-[rgba(197,160,89,0.2)] rounded-xl py-3 pl-10 pr-4 text-sm focus:outline-none focus:border-[#C5A059]">
                        <svg class="w-5 h-5 text-[#8B7355] absolute left-3 top-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                </div>

                <div class="flex gap-2 px-4 pb-3 overflow-x-auto no-scrollbar">
                    <button class="category-pill active">Todo</button>
                    <button class="category-pill">Alimentaci√≥n</button>
                    <button class="category-pill">Juguetes</button>
                    <button class="category-pill">Higiene</button>
                    <button class="category-pill">Accesorios</button>
                </div>

                <div class="grid grid-cols-2 gap-3 px-4 pb-4">
                    <div class="product-card">
                        <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1589924691195-41432c84c161?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                        </div>
                        <div class="p-3">
                            <h3 class="text-sm font-medium text-[#4B3621]">Perrarina Premium</h3>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-[#C5A059] font-bold">$54.99</span>
                                <button class="w-7 h-7 bg-[#F0EAD6] rounded-full flex items-center justify-center text-[#4B3621]">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card">
                        <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1576201836106-db1758fd1c97?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                        </div>
                        <div class="p-3">
                            <h3 class="text-sm font-medium text-[#4B3621]">Collar GPS</h3>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-[#C5A059] font-bold">$129.99</span>
                                <button class="w-7 h-7 bg-[#F0EAD6] rounded-full flex items-center justify-center text-[#4B3621]">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card">
                        <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1541599540903-216a46ca1dc0?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                        </div>
                        <div class="p-3">
                            <h3 class="text-sm font-medium text-[#4B3621]">Juguete Resistente</h3>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-[#C5A059] font-bold">$24.50</span>
                                <button class="w-7 h-7 bg-[#F0EAD6] rounded-full flex items-center justify-center text-[#4B3621]">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card">
                        <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1516734212186-a967f81ad0d7?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                        </div>
                        <div class="p-3">
                            <h3 class="text-sm font-medium text-[#4B3621]">Champ√∫ Org√°nico</h3>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-[#C5A059] font-bold">$18.90</span>
                                <button class="w-7 h-7 bg-[#F0EAD6] rounded-full flex items-center justify-center text-[#4B3621]">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- SCREEN: GROOMING (EL STUDIO DE MAR√çA) - NUEVO HUB CENTRAL -->
        <!-- ============================================================ -->
        <div id="mc-screen-grooming" class="screen hidden">
            <!-- Header -->
            <div class="safe-header grooming-header px-4 flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold text-[#4B3621] font-serif">El Studio de Mar√≠a</h1>
                    <p class="text-xs text-[#C5A059] font-medium">Peluquer√≠a Canina Premium</p>
                </div>
                <button onclick="showScreen('mc-screen-booking-local')" class="cta-button flex items-center gap-2 text-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Agendar Cita
                </button>
            </div>

            <div class="screen-content">
                <!-- Secci√≥n Portafolio (Stories-style) -->
                <div class="bg-white py-4">
                    <div class="px-4 mb-3">
                        <h2 class="text-sm font-bold text-[#4B3621] uppercase tracking-wide">Trabajos Recientes</h2>
                    </div>
                    <div class="flex overflow-x-auto gap-4 px-4 pb-2 no-scrollbar">
                        <div class="flex flex-col items-center flex-shrink-0">
                            <div class="portfolio-ring">
                                <img src="https://images.unsplash.com/photo-1518717758536-85ae29035b6d?w=200&h=200&fit=crop" class="portfolio-avatar" alt="Trabajo 1">
                            </div>
                            <span class="text-xs text-[#4B3621] mt-2 font-medium">Luna</span>
                        </div>
                        <div class="flex flex-col items-center flex-shrink-0">
                            <div class="portfolio-ring">
                                <img src="https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=200&h=200&fit=crop" class="portfolio-avatar" alt="Trabajo 2">
                            </div>
                            <span class="text-xs text-[#4B3621] mt-2 font-medium">Max</span>
                        </div>
                        <div class="flex flex-col items-center flex-shrink-0">
                            <div class="portfolio-ring">
                                <img src="https://images.unsplash.com/photo-1537151608828-ea2b11777ee8?w=200&h=200&fit=crop" class="portfolio-avatar" alt="Trabajo 3">
                            </div>
                            <span class="text-xs text-[#4B3621] mt-2 font-medium">Bella</span>
                        </div>
                        <div class="flex flex-col items-center flex-shrink-0">
                            <div class="portfolio-ring">
                                <img src="https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?w=200&h=200&fit=crop" class="portfolio-avatar" alt="Trabajo 4">
                            </div>
                            <span class="text-xs text-[#4B3621] mt-2 font-medium">Rocky</span>
                        </div>
                        <div class="flex flex-col items-center flex-shrink-0">
                            <div class="portfolio-ring">
                                <img src="https://images.unsplash.com/photo-1596492784531-6e6eb5ea9205?w=200&h=200&fit=crop" class="portfolio-avatar" alt="Trabajo 5">
                            </div>
                            <span class="text-xs text-[#4B3621] mt-2 font-medium">Coco</span>
                        </div>
                        <div class="flex flex-col items-center flex-shrink-0">
                            <div class="portfolio-ring">
                                <img src="https://images.unsplash.com/photo-1552053831-71594a27632d?w=200&h=200&fit=crop" class="portfolio-avatar" alt="Trabajo 6">
                            </div>
                            <span class="text-xs text-[#4B3621] mt-2 font-medium">Daisy</span>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n Avisos de Mar√≠a (Twitter-style) -->
                <div class="px-4 py-6">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-8 h-8 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
                            </svg>
                        </div>
                        <h2 class="text-lg font-bold text-[#4B3621]">Avisos de Mar√≠a</h2>
                    </div>

                    <!-- Anuncio 1 -->
                    <div class="announcement-card">
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-white font-bold text-sm">M</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-bold text-[#4B3621]">Mar√≠a</span>
                                    <span class="text-xs text-[#8B7355]">‚Ä¢ Hace 2 horas</span>
                                </div>
                                <p class="text-[#4B3621] text-sm leading-relaxed">
                                    üì¢ <span class="font-semibold">¬°Atenci√≥n!</span> La pr√≥xima semana (Mi√©rcoles 12) tenemos <span class="text-[#C5A059] font-semibold">10% de descuento</span> en Ba√±os Medicados. ¬°Agenda tu cita! üêï‚ú®
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Anuncio 2 -->
                    <div class="announcement-card">
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-white font-bold text-sm">M</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-bold text-[#4B3621]">Mar√≠a</span>
                                    <span class="text-xs text-[#8B7355]">‚Ä¢ Ayer</span>
                                </div>
                                <p class="text-[#4B3621] text-sm leading-relaxed">
                                    üöê Nuestra Furgoneta Luna estar√° en <span class="font-semibold">Las Condes</span> este viernes. ¬°Reserva tu cita a domicilio! Cupos limitados.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Anuncio 3 -->
                    <div class="announcement-card">
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-white font-bold text-sm">M</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-bold text-[#4B3621]">Mar√≠a</span>
                                    <span class="text-xs text-[#8B7355]">‚Ä¢ Hace 3 d√≠as</span>
                                </div>
                                <p class="text-[#4B3621] text-sm leading-relaxed">
                                    üíÖ Nuevo servicio: <span class="font-semibold">Spa de U√±as</span> para perros peque√±os. Incluye limado, cut√≠cula y esmalte pet-friendly. ¬°Pregunta por el paquete completo!
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Anuncio 4 -->
                    <div class="announcement-card">
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-white font-bold text-sm">M</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-bold text-[#4B3621]">Mar√≠a</span>
                                    <span class="text-xs text-[#8B7355]">‚Ä¢ Hace 5 d√≠as</span>
                                </div>
                                <p class="text-[#4B3621] text-sm leading-relaxed">
                                    üéâ ¬°Felicitaciones a todos los clientes que participaron en nuestro concurso de fotos! Las ganadoras ser√°n anunciadas este fin de semana. ¬°Est√©n atentos!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Servicios R√°pidos -->
                <div class="px-4 pb-6">
                    <h2 class="text-sm font-bold text-[#4B3621] uppercase tracking-wide mb-4">Nuestros Servicios</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-white rounded-2xl p-4 border border-[rgba(197,160,89,0.2)]">
                            <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center mb-3">
                                <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-[#4B3621] text-sm">Ba√±o & Corte</h3>
                            <p class="text-xs text-[#8B7355] mt-1">Desde $35.000</p>
                        </div>
                        <div class="bg-white rounded-2xl p-4 border border-[rgba(197,160,89,0.2)]">
                            <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center mb-3">
                                <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-[#4B3621] text-sm">Spa Deluxe</h3>
                            <p class="text-xs text-[#8B7355] mt-1">Desde $55.000</p>
                        </div>
                        <div class="bg-white rounded-2xl p-4 border border-[rgba(197,160,89,0.2)]">
                            <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center mb-3">
                                <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-[#4B3621] text-sm">A Domicilio</h3>
                            <p class="text-xs text-[#8B7355] mt-1">Furgoneta VIP</p>
                        </div>
                        <div class="bg-white rounded-2xl p-4 border border-[rgba(197,160,89,0.2)]">
                            <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center mb-3">
                                <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-[#4B3621] text-sm">Tratamientos</h3>
                            <p class="text-xs text-[#8B7355] mt-1">Piel & Pelo</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- SCREEN: ASSISTANT (CHAT IA) -->
        <!-- ============================================================ -->
        <div id="screen-assistant" class="screen hidden">
            <div class="safe-header px-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-[#4B3621]">Asistente Maria's Cut</h1>
                        <p class="text-xs text-[#C5A059]">Experto en bienestar animal</p>
                    </div>
                </div>
            </div>

            <div class="chat-container">
                <div id="chat-messages" class="chat-messages">
                    <div class="chat-bubble bot">
                        Hola, soy la IA de Maria's Cut. ¬øEn qu√© puedo ayudarte hoy con tu mascota? üêæ
                    </div>
                </div>

                <div class="chat-input-area">
                    <div class="chat-input-wrapper">
                        <input type="text" id="chat-input" class="chat-input" placeholder="Escribe tu mensaje..." onkeypress="handleChatKeyPress(event)">
                        <button class="chat-send-btn" onclick="sendChatMessage()">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- SCREEN: PROFILE (PERFIL) -->
        <!-- ============================================================ -->
        <div id="screen-profile" class="screen hidden">
            <div class="profile-header px-4">
                <div class="flex items-center gap-4">
                    <div class="w-20 h-20 bg-white rounded-full p-1 shadow-lg overflow-hidden">
                        <img id="profile-avatar" src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop" class="w-full h-full rounded-full object-cover">
                    </div>
                    <div>
                        <h1 id="profile-name" class="text-xl font-bold text-[#4B3621]">Cargando...</h1>
                        <p id="profile-pet" class="text-sm text-[#8B7355]">...</p>
                        <div class="flex items-center gap-1 mt-1">
                            <svg class="w-4 h-4 text-[#C5A059]" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                            <span class="text-sm text-[#4B3621] font-medium">4.9 (128 rese√±as)</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="screen-content">
                <!-- Stats -->
                <div class="flex justify-around py-4 bg-white border-b border-[rgba(197,160,89,0.15)]">
                    <div class="text-center">
                        <p class="text-xl font-bold text-[#C5A059]">1</p>
                        <p class="text-xs text-[#8B7355]">Mascota</p>
                    </div>
                    <div class="text-center">
                        <p class="text-xl font-bold text-[#C5A059]">0</p>
                        <p class="text-xs text-[#8B7355]">Citas</p>
                    </div>
                    <div class="text-center">
                        <p class="text-xl font-bold text-[#C5A059]">0</p>
                        <p class="text-xs text-[#8B7355]">Posts</p>
                    </div>
                </div>

                <!-- Menu Items -->
                <div class="px-4 py-4 space-y-2">
                    <div class="bg-white rounded-2xl p-4 flex items-center gap-4 border border-[rgba(197,160,89,0.15)]">
                        <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-[#4B3621]">Mis Datos</h3>
                            <p class="text-xs text-[#8B7355]">Informaci√≥n personal</p>
                        </div>
                        <svg class="w-5 h-5 text-[#8B7355]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>

                    <div class="bg-white rounded-2xl p-4 flex items-center gap-4 border border-[rgba(197,160,89,0.15)]">
                        <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-[#4B3621]">Mis Citas</h3>
                            <p class="text-xs text-[#8B7355]">Historial y pr√≥ximas</p>
                        </div>
                        <svg class="w-5 h-5 text-[#8B7355]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>

                    <div class="bg-white rounded-2xl p-4 flex items-center gap-4 border border-[rgba(197,160,89,0.15)]" onclick="handleLogout()">
                        <div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-red-500">Cerrar Sesi√≥n</h3>
                            <p class="text-xs text-[#8B7355]">Salir de la cuenta</p>
                        </div>
                        <svg class="w-5 h-5 text-[#8B7355]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- PANTALLAS DE RESERVAS (INTEGRADAS DEL BACKUP) -->
        <!-- ============================================================ -->

        <!-- SCREEN: BOOKING LOCAL (Reserva en Local) -->
        <div id="mc-screen-booking-local" class="screen hidden">
            <div class="safe-header border-b border-gray-100 pb-4 px-5 flex items-center">
                <button onclick="showScreen('mc-screen-grooming')" class="p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h1 class="text-lg font-semibold text-gray-800 ml-2">Reserva en Local</h1>
            </div>

            <div class="screen-content px-5 pt-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Selecciona un servicio</h2>

                <!-- Grooming Card -->
                <div class="bg-white rounded-2xl shadow-md p-4 border-2 border-transparent hover:border-gray-200 cursor-pointer mb-4 transition-colors" onclick="selectService('banio', 35000)">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">Ba√±o & Corte Pro</h3>
                            <p class="text-gray-500 text-sm mt-1">Shampoo org√°nico, corte a tijera</p>
                            <div class="flex items-center mt-2 text-gray-400 text-sm">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                60 min
                            </div>
                        </div>
                        <p class="text-xl font-bold text-[#C5A059]">$35.000</p>
                    </div>
                </div>

                <!-- Spa Card -->
                <div class="bg-white rounded-2xl shadow-md p-4 border-2 border-[#C5A059] cursor-pointer mb-6" onclick="selectService('spa', 55000)">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">Spa Deluxe</h3>
                            <p class="text-gray-500 text-sm mt-1">Hidromasaje + Aromaterapia</p>
                            <div class="flex items-center mt-2 text-gray-400 text-sm">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                90 min
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-bold text-[#C5A059]">$55.000</p>
                            <span class="bg-[#C5A059]/10 text-[#C5A059] text-xs px-2 py-1 rounded-full font-bold">Popular</span>
                        </div>
                    </div>
                </div>

                <!-- Pet Selector -->
                <div class="mb-6">
                    <p class="text-gray-700 font-medium mb-2">Para tu mascota</p>
                </div>

                <!-- Confirm Button -->
                <button onclick="goToPayment()" class="btn-ripple w-full bg-[#C5A059] hover:bg-[#A88B45] text-white font-semibold py-4 rounded-2xl transition-colors shadow-lg">Continuar al Pago</button>
            </div>
        </div>

        <!-- SCREEN: PAYMENT (Stripe) -->
        <div id="mc-screen-payment" class="screen hidden">
            <div class="safe-header border-b border-gray-100 pb-4 px-5 flex items-center">
                <button onclick="showScreen('mc-screen-booking-local')" class="p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h1 class="text-lg font-semibold text-gray-800 ml-2">Confirmar y Pagar</h1>
            </div>

            <div class="screen-content px-5 pt-6">
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-16 h-16 bg-[#F0EAD6] rounded-xl flex items-center justify-center">
                            <svg class="w-8 h-8 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 id="payment-service-name" class="font-bold text-gray-800 text-lg">Spa Deluxe</h3>
                            <p class="text-gray-500 text-sm">Servicio Premium</p>
                        </div>
                    </div>
                    <div class="border-t border-gray-100 pt-4">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Subtotal</span>
                            <span id="payment-subtotal" class="font-medium">$55.000</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">IVA (19%)</span>
                            <span id="payment-iva" class="font-medium">$10.450</span>
                        </div>
                        <div class="flex justify-between pt-2 border-t border-gray-100">
                            <span class="font-bold text-gray-800">Total</span>
                            <span id="payment-total" class="font-bold text-[#C5A059] text-xl">$65.450</span>
                        </div>
                    </div>
                </div>

                <button onclick="handleStripePayment()" class="cta-button-gold flex items-center justify-center gap-3">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                    </svg>
                    Pagar Ahora y Confirmar
                </button>

                <button onclick="showScreen('mc-screen-grooming')" class="login-btn-secondary mt-4">Cancelar</button>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- NUEVA BARRA DE NAVEGACI√ìN CON 5 ELEMENTOS -->
        <!-- ============================================================ -->
        <div class="bottom-nav" id="main-nav">
            <div class="nav-container">
                <!-- Club (Izquierda) -->
                <div class="nav-item" onclick="showScreen('screen-home', this)">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/>
                    </svg>
                    <span class="text-xs mt-1">Club</span>
                </div>

                <!-- Tienda (Izquierda) -->
                <div class="nav-item" onclick="showScreen('screen-shop', this)">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                    </svg>
                    <span class="text-xs mt-1">Tienda</span>
                </div>

                <!-- PELUQUER√çA (Centro - DESTACADO) -->
                <div class="nav-center-btn" onclick="showScreen('mc-screen-grooming', this)" id="nav-grooming">
                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"/>
                    </svg>
                    <span class="nav-center-label">Peluquer√≠a</span>
                </div>

                <!-- Asistente (Derecha) -->
                <div class="nav-item" onclick="showScreen('screen-assistant', this)">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    <span class="text-xs mt-1">Asistente</span>
                </div>

                <!-- Perfil (Derecha) -->
                <div class="nav-item" onclick="showScreen('screen-profile', this)">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    <span class="text-xs mt-1">Perfil</span>
                </div>
            </div>
        </div>

        <!-- Action Sheet -->
        <div class="action-sheet-overlay" id="action-overlay" onclick="hideActionSheet()"></div>
        <div class="action-sheet" id="action-sheet">
            <div class="action-item" onclick="document.getElementById('post-input').click()">
                üì∑ Subir Foto
            </div>
            <div class="action-item" onclick="document.getElementById('post-video-input').click()">
                üé• Subir Video
            </div>
            <div class="action-item danger" onclick="hideActionSheet()">
                Cancelar
            </div>
        </div>

        <!-- Upload Progress -->
        <div class="upload-progress hidden" id="upload-progress">
            <p class="text-[#4B3621] font-medium">Subiendo...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <p class="text-sm text-[#8B7355] mt-2" id="progress-text">0%</p>
        </div>

        <!-- Hidden File Inputs -->
        <input type="file" id="story-input" class="hidden" accept="image/*,video/*" onchange="handleStoryUpload(event)">
        <input type="file" id="post-input" class="hidden" accept="image/*" onchange="handlePostUpload(event)">
        <input type="file" id="post-video-input" class="hidden" accept="video/*" onchange="handlePostUpload(event)">
    </div>

    <!-- ============================================================ -->
    <!-- FIREBASE SDK & APP LOGIC -->
    <!-- ============================================================ -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { 
            getAuth, 
            onAuthStateChanged, 
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signInAnonymously,
            signOut,
            updateProfile
        } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc,
            collection,
            addDoc,
            onSnapshot,
            query,
            orderBy,
            serverTimestamp
        } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        import { 
            getStorage, 
            ref, 
            uploadBytesResumable,
            getDownloadURL
        } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js';

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBTJ1Gf__zEpi9SkA1LkJ8pYz4Jb0zkU8A",
            authDomain: "maria-s-cut.firebaseapp.com",
            projectId: "maria-s-cut",
            storageBucket: "maria-s-cut.firebasestorage.app",
            messagingSenderId: "387590858198",
            appId: "1:387590858198:web:0848e746b595543f0af077",
            measurementId: "G-CW33W93S9Y"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Global state
        let currentUser = null;
        let userData = null;
        let selectedService = { name: 'Spa Deluxe', price: 55000 };
        let pendingPhotoFile = null;

        // Make functions global
        window.auth = auth;
        window.db = db;
        window.storage = storage;
        window.currentUser = currentUser;
        window.userData = userData;
        window.selectedService = selectedService;
        window.pendingPhotoFile = pendingPhotoFile;

        // Auth State Listener
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                window.currentUser = user;
                
                // Get user data from Firestore
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    userData = userDoc.data();
                    window.userData = userData;
                    updateProfileUI();
                }
                
                // Show main app
                showScreen('mc-screen-grooming');
                document.getElementById('main-nav').style.display = 'block';
                
                // Load feed
                loadFeed();
                loadStories();
            } else {
                // Show login
                showScreen('mc-login');
                document.getElementById('main-nav').style.display = 'none';
            }
        });

        // Login Handler
        window.handleLogin = async () => {
            const name = document.getElementById('login-name').value.trim();
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const pet = document.getElementById('login-pet').value.trim();
            const phone = document.getElementById('login-phone').value.trim();
            const errorEl = document.getElementById('login-error');

            if (!email || !password) {
                errorEl.textContent = 'Email y contrase√±a son requeridos';
                errorEl.classList.remove('hidden');
                return;
            }

            try {
                // Try to sign in first
                let userCredential;
                try {
                    userCredential = await signInWithEmailAndPassword(auth, email, password);
                } catch (signInError) {
                    // If sign in fails, create new account
                    userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    
                    // Save user data to Firestore
                    await setDoc(doc(db, 'users', userCredential.user.uid), {
                        name: name || 'Usuario',
                        email: email,
                        petName: pet || 'Mi Mascota',
                        phone: phone || '',
                        createdAt: serverTimestamp()
                    });
                    
                    // Update profile
                    await updateProfile(userCredential.user, {
                        displayName: name || 'Usuario'
                    });
                    
                    // Show profile photo screen for new users
                    showScreen('mc-profile-photo');
                    return;
                }
                
                // Existing user - will be handled by onAuthStateChanged
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.remove('hidden');
            }
        };

        // Skip Login (Anonymous)
        window.handleSkip = async () => {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error('Anonymous auth error:', error);
            }
        };

        // Logout
        window.handleLogout = async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error('Logout error:', error);
            }
        };

        // Profile Photo Selection
        window.handleProfilePhotoSelect = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            pendingPhotoFile = file;
            window.pendingPhotoFile = file;
            
            // Preview
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('photo-preview').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover">`;
                document.getElementById('save-photo-btn').disabled = false;
            };
            reader.readAsDataURL(file);
        };

        // Save Profile Photo
        window.saveProfilePhoto = async () => {
            if (!pendingPhotoFile || !currentUser) return;
            
            const progressEl = document.getElementById('upload-progress');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            
            progressEl.classList.remove('hidden');
            
            const storageRef = ref(storage, `profile_pics/${currentUser.uid}`);
            const uploadTask = uploadBytesResumable(storageRef, pendingPhotoFile);
            
            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = Math.round(progress) + '%';
                },
                (error) => {
                    console.error('Upload error:', error);
                    progressEl.classList.add('hidden');
                    alert('Error al subir la foto');
                },
                async () => {
                    const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                    
                    // Update user profile
                    await updateProfile(currentUser, { photoURL: downloadURL });
                    
                    // Update Firestore
                    await setDoc(doc(db, 'users', currentUser.uid), {
                        photoURL: downloadURL
                    }, { merge: true });
                    
                    progressEl.classList.add('hidden');
                    showScreen('mc-screen-grooming');
                }
            );
        };

        // Skip Profile Photo
        window.skipProfilePhoto = () => {
            showScreen('mc-screen-grooming');
        };

        // Update Profile UI
        window.updateProfileUI = () => {
            if (userData) {
                document.getElementById('profile-name').textContent = userData.name || 'Usuario';
                document.getElementById('profile-pet').textContent = userData.petName ? `üêï ${userData.petName}` : '';
            }
            if (currentUser?.photoURL) {
                document.getElementById('profile-avatar').src = currentUser.photoURL;
            }
        };

        // Story Upload
        window.handleStoryUpload = async (event) => {
            const file = event.target.files[0];
            if (!file || !currentUser) return;
            
            const progressEl = document.getElementById('upload-progress');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            
            progressEl.classList.remove('hidden');
            
            const fileName = `stories/${currentUser.uid}_${Date.now()}.${file.name.split('.').pop()}`;
            const storageRef = ref(storage, fileName);
            const uploadTask = uploadBytesResumable(storageRef, file);
            
            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = Math.round(progress) + '%';
                },
                (error) => {
                    console.error('Upload error:', error);
                    progressEl.classList.add('hidden');
                    alert('Error al subir la historia');
                },
                async () => {
                    const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                    
                    // Create story document
                    await addDoc(collection(db, 'stories'), {
                        userId: currentUser.uid,
                        userName: userData?.name || 'Usuario',
                        userPhoto: currentUser.photoURL || '',
                        mediaUrl: downloadURL,
                        mediaType: file.type.startsWith('video') ? 'video' : 'image',
                        createdAt: serverTimestamp()
                    });
                    
                    progressEl.classList.add('hidden');
                    alert('¬°Historia subida exitosamente!');
                }
            );
        };

        // Post Upload
        window.handlePostUpload = async (event) => {
            const file = event.target.files[0];
            if (!file || !currentUser) return;
            
            hideActionSheet();
            
            const progressEl = document.getElementById('upload-progress');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            
            progressEl.classList.remove('hidden');
            
            const fileName = `posts/${currentUser.uid}_${Date.now()}.${file.name.split('.').pop()}`;
            const storageRef = ref(storage, fileName);
            const uploadTask = uploadBytesResumable(storageRef, file);
            
            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = Math.round(progress) + '%';
                },
                (error) => {
                    console.error('Upload error:', error);
                    progressEl.classList.add('hidden');
                    alert('Error al subir el post');
                },
                async () => {
                    const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                    
                    // Create post document
                    await addDoc(collection(db, 'posts'), {
                        userId: currentUser.uid,
                        userName: userData?.name || 'Usuario',
                        userPhoto: currentUser.photoURL || '',
                        mediaUrl: downloadURL,
                        mediaType: file.type.startsWith('video') ? 'video' : 'image',
                        caption: 'Nueva publicaci√≥n üêæ',
                        likes: 0,
                        createdAt: serverTimestamp()
                    });
                    
                    progressEl.classList.add('hidden');
                    alert('¬°Publicaci√≥n creada exitosamente!');
                }
            );
        };

        // Load Feed (Real-time)
        window.loadFeed = () => {
            const feedContainer = document.getElementById('feed-container');
            const postsQuery = query(collection(db, 'posts'), orderBy('createdAt', 'desc'));
            
            onSnapshot(postsQuery, (snapshot) => {
                let html = '';
                snapshot.forEach((doc) => {
                    const post = doc.data();
                    html += `
                        <div class="social-card">
                            <div class="flex items-center justify-between p-3">
                                <div class="flex items-center gap-2">
                                    <img src="${post.userPhoto || 'https://randomuser.me/api/portraits/lego/1.jpg'}" class="w-8 h-8 rounded-full object-cover">
                                    <div>
                                        <h4 class="text-sm font-bold text-[#4B3621]">${post.userName}</h4>
                                        <p class="text-xs text-[#8B7355]">Maria's Social Club</p>
                                    </div>
                                </div>
                            </div>
                            ${post.mediaType === 'video' 
                                ? `<video src="${post.mediaUrl}" class="post-media" controls></video>`
                                : `<img src="${post.mediaUrl}" class="post-media">`
                            }
                            <div class="p-3">
                                <div class="flex gap-4 mb-2">
                                    <svg class="w-6 h-6 text-[#4B3621] cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                    </svg>
                                    <svg class="w-6 h-6 text-[#4B3621]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                    </svg>
                                </div>
                                <p class="text-xs font-bold text-[#4B3621]">${post.likes || 0} Me gusta</p>
                                <p class="text-sm text-[#4B3621] mt-1"><span class="font-bold">${post.userName}</span> ${post.caption}</p>
                            </div>
                        </div>
                    `;
                });
                feedContainer.innerHTML = html;
            });
        };

        // Load Stories (Real-time)
        window.loadStories = () => {
            const storiesContainer = document.getElementById('stories-container');
            const storiesQuery = query(collection(db, 'stories'), orderBy('createdAt', 'desc'));
            
            onSnapshot(storiesQuery, (snapshot) => {
                let html = `
                    <div class="story-item" onclick="document.getElementById('story-input').click()">
                        <div class="story-avatar-ring" style="background: transparent; border: 2px dashed #C5A059;">
                            <div class="w-full h-full bg-white rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                            </div>
                        </div>
                        <span class="text-xs text-[#6D5D4E] mt-1">Tu Historia</span>
                    </div>
                `;
                
                snapshot.forEach((doc) => {
                    const story = doc.data();
                    html += `
                        <div class="story-item" onclick="viewStory('${story.userName}')">
                            <div class="story-avatar-ring">
                                <img src="${story.mediaUrl}" class="story-avatar" alt="${story.userName}">
                            </div>
                            <span class="text-xs text-[#4B3621] mt-1 font-medium">${story.userName}</span>
                        </div>
                    `;
                });
                
                storiesContainer.innerHTML = html;
            });
        };

        // Service Selection
        window.selectService = (type, price) => {
            selectedService = { 
                name: type === 'spa' ? 'Spa Deluxe' : 'Ba√±o & Corte Pro', 
                price: price 
            };
            window.selectedService = selectedService;
        };

        // Go to Payment
        window.goToPayment = () => {
            const subtotal = selectedService.price;
            const iva = Math.round(subtotal * 0.19);
            const total = subtotal + iva;
            
            document.getElementById('payment-service-name').textContent = selectedService.name;
            document.getElementById('payment-subtotal').textContent = `$${subtotal.toLocaleString()}`;
            document.getElementById('payment-iva').textContent = `$${iva.toLocaleString()}`;
            document.getElementById('payment-total').textContent = `$${total.toLocaleString()}`;
            
            showScreen('mc-screen-payment');
        };

        // Stripe Payment
        window.handleStripePayment = () => {
            window.open('https://buy.stripe.com/14A8wH1Yjd6E0The7Adby00', '_blank');
        };

        // Navigation
        window.showScreen = (screenId, navElement) => {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.add('hidden');
                s.classList.remove('active');
            });
            
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                targetScreen.classList.add('active');
            }

            if (navElement) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.querySelectorAll('.nav-center-btn').forEach(n => n.classList.remove('active'));
                
                if (navElement.classList.contains('nav-item')) {
                    navElement.classList.add('active');
                } else if (navElement.classList.contains('nav-center-btn')) {
                    navElement.classList.add('active');
                }
            }
        };

        // Action Sheet
        window.showActionSheet = () => {
            document.getElementById('action-overlay').classList.add('open');
            document.getElementById('action-sheet').classList.add('open');
        };

        window.hideActionSheet = () => {
            document.getElementById('action-overlay').classList.remove('open');
            document.getElementById('action-sheet').classList.remove('open');
        };

        // Chat
        window.handleChatKeyPress = (e) => {
            if (e.key === 'Enter') sendChatMessage();
        };

        window.sendChatMessage = () => {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if (!msg) return;

            const container = document.getElementById('chat-messages');
            
            container.innerHTML += `<div class="chat-bubble user">${msg}</div>`;
            input.value = '';
            container.scrollTop = container.scrollHeight;

            setTimeout(() => {
                const responses = [
                    "Entiendo. Para m√°s informaci√≥n, cont√°ctanos al +56 9 1234 5678 üìû",
                    "¬°Buena pregunta! Te sugiero visitar nuestra sede en Av. Providencia 1234 üìç",
                    "Perfecto, anotado. ¬øAlgo m√°s en lo que pueda ayudarte?",
                    "Claro, te recomiendo agendar una cita para que tu mascota reciba la mejor atenci√≥n ‚ú®"
                ];
                const resp = responses[Math.floor(Math.random() * responses.length)];
                container.innerHTML += `<div class="chat-bubble bot">${resp}</div>`;
                container.scrollTop = container.scrollHeight;
            }, 800);
        };

        window.viewStory = (name) => {
            alert(`Viendo historia de ${name}`);
        };
    </script>
</body>
</html>
