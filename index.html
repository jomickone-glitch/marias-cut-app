<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Maria's Cut</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F9F7F2">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="778405F5-FB9C-47F4-908A-185070ECD1DC.PNG">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#C5A059',
                        primaryDark: '#A88B45',
                        secondary: '#D4B896',
                        secondaryDark: '#B89C7A',
                        background: '#F9F7F2',
                        gold: '#D4AF37',
                        goldLight: '#E8D5A3',
                    },
                    fontFamily: {
                        sans: ['Quicksand', 'Poppins', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100dvh; overflow: hidden; font-family: 'Quicksand', 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif; background: #F9F7F2; touch-action: manipulation; }
        #app-container { width: 100%; height: 100%; position: relative; overflow: hidden; background: #F9F7F2; }
        .safe-header { padding-top: calc(env(safe-area-inset-top, 0px) + 10px); padding-bottom: 12px; background: #FFFDF5; border-bottom: 1px solid rgba(197, 160, 89, 0.15); position: sticky; top: 0; z-index: 50; flex-shrink: 0; }
        .header-gradient { background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%); padding-top: calc(env(safe-area-inset-top, 0px) + 12px); padding-bottom: 8px; position: sticky; top: 0; z-index: 10; }
        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; background: #F9F7F2; overflow: hidden; transition: opacity 0.3s ease; }
        .screen.hidden { opacity: 0; pointer-events: none; z-index: -1; }
        .screen.active { opacity: 1; pointer-events: auto; z-index: 1; }
        .screen-content { flex: 1; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 100px); }
        .login-screen { background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%); justify-content: center; padding: 24px; z-index: 100; }
        .login-logo { width: 100px; height: 100px; background: linear-gradient(135deg, #D4AF37 0%, #C5A059 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; box-shadow: 0 8px 32px rgba(212, 175, 55, 0.4); }
        .login-input { width: 100%; padding: 16px 20px; border-radius: 16px; border: 2px solid rgba(197, 160, 89, 0.3); background: white; font-size: 1rem; margin-bottom: 12px; outline: none; transition: all 0.3s ease; }
        .login-input:focus { border-color: #C5A059; box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.15); }
        .login-btn { width: 100%; padding: 16px; border-radius: 50px; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; font-weight: 600; font-size: 1rem; border: none; cursor: pointer; box-shadow: 0 4px 16px rgba(197, 160, 89, 0.4); transition: all 0.3s ease; margin-top: 8px; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(197, 160, 89, 0.5); }
        .login-btn-secondary { width: 100%; padding: 14px; border-radius: 50px; background: transparent; color: #4B3621; font-weight: 500; font-size: 0.95rem; border: 2px solid rgba(197, 160, 89, 0.4); cursor: pointer; transition: all 0.3s ease; margin-top: 12px; }
        .login-btn-secondary:hover { background: rgba(197, 160, 89, 0.1); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #FFFDF5; border-top: 1px solid rgba(197, 160, 89, 0.2); padding-bottom: env(safe-area-inset-bottom, 0px); z-index: 100; height: 80px; transition: transform 0.3s ease; }
        .bottom-nav.hidden { transform: translateY(100%); }
        .nav-container { display: flex; justify-content: space-around; align-items: flex-start; padding-top: 8px; position: relative; }
        .nav-item { display: flex; flex-direction: column; align-items: center; padding: 8px 12px; cursor: pointer; transition: color 0.2s ease; flex: 1; }
        .nav-item.active { color: #C5A059; }
        .nav-item:not(.active) { color: #8B7355; }
        .nav-center-btn { position: relative; top: -28px; width: 72px; height: 72px; border-radius: 50%; background: linear-gradient(135deg, #D4AF37 0%, #C5A059 50%, #B8941F 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 8px 32px rgba(212, 175, 55, 0.5), 0 4px 16px rgba(197, 160, 89, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.3); border: 3px solid #FFFDF5; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); flex-shrink: 0; z-index: 10; }
        .nav-center-btn:active { transform: scale(0.95); }
        .nav-center-label { position: absolute; bottom: -22px; font-size: 0.7rem; font-weight: 600; color: #C5A059; white-space: nowrap; }
        .stories-rail { display: flex; overflow-x: auto; gap: 12px; padding: 12px 16px; background: #FFFDF5; border-bottom: 1px solid rgba(197, 160, 89, 0.1); }
        .stories-rail::-webkit-scrollbar { display: none; }
        .story-item { display: flex; flex-direction: column; align-items: center; flex-shrink: 0; cursor: pointer; }
        .story-avatar-ring { width: 64px; height: 64px; border-radius: 50%; padding: 3px; background: linear-gradient(45deg, #F0EAD6, #C5A059, #D4B896); }
        .story-avatar-ring.has-stories { background: linear-gradient(45deg, #D4AF37, #C5A059, #D4B896); animation: pulse-ring 2s infinite; }
        @keyframes pulse-ring { 0%, 100% { box-shadow: 0 0 0 0 rgba(197, 160, 89, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(197, 160, 89, 0); } }
        .story-avatar { width: 100%; height: 100%; border-radius: 50%; border: 3px solid #FFFDF5; object-fit: cover; }
        .camera-overlay { position: fixed; inset: 0; background: black; z-index: 500; display: none; flex-direction: column; }
        .camera-overlay.active { display: flex; }
        .camera-preview { flex: 1; position: relative; overflow: hidden; }
        .camera-video { width: 100%; height: 100%; object-fit: cover; }
        .camera-canvas { display: none; }
        .camera-controls { position: absolute; bottom: 40px; left: 0; right: 0; display: flex; justify-content: center; align-items: center; gap: 40px; padding: 0 24px; }
        .camera-btn-capture { width: 80px; height: 80px; border-radius: 50%; background: white; border: 4px solid rgba(255, 255, 255, 0.3); cursor: pointer; position: relative; transition: transform 0.1s; }
        .camera-btn-capture:active { transform: scale(0.9); }
        .camera-btn-capture::after { content: ''; position: absolute; inset: 4px; border-radius: 50%; background: white; border: 2px solid #C5A059; }
        .camera-btn-gallery { width: 50px; height: 50px; border-radius: 8px; overflow: hidden; cursor: pointer; border: 2px solid white; }
        .camera-btn-gallery img { width: 100%; height: 100%; object-fit: cover; }
        .camera-btn-close { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 20px); right: 20px; width: 44px; height: 44px; border-radius: 50%; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; }
        .camera-mode-switch { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 20px); left: 50%; transform: translateX(-50%); display: flex; gap: 16px; background: rgba(0, 0, 0, 0.5); padding: 8px 16px; border-radius: 20px; }
        .camera-mode-btn { color: white; font-size: 14px; font-weight: 500; background: none; border: none; cursor: pointer; opacity: 0.6; }
        .camera-mode-btn.active { opacity: 1; }
        .post-editor-modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95); z-index: 600; display: none; flex-direction: column; }
        .post-editor-modal.active { display: flex; }
        .post-editor-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; padding-top: calc(env(safe-area-inset-top, 0px) + 16px); }
        .post-editor-preview { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .post-editor-preview img, .post-editor-preview video { max-width: 100%; max-height: 50vh; border-radius: 16px; object-fit: contain; }
        .post-editor-footer { padding: 20px; padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 20px); background: #1a1a1a; }
        .post-editor-input { width: 100%; background: #2a2a2a; border: none; border-radius: 12px; padding: 16px; color: white; font-size: 16px; resize: none; margin-bottom: 16px; }
        .post-editor-input::placeholder { color: #888; }
        .post-editor-submit { width: 100%; padding: 16px; border-radius: 50px; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; font-weight: 700; font-size: 16px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .story-canvas-editor { position: fixed; inset: 0; background: #000; z-index: 650; display: none; flex-direction: column; }
        .story-canvas-editor.active { display: flex; }
        .story-canvas-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; padding-top: calc(env(safe-area-inset-top, 0px) + 16px); background: rgba(0, 0, 0, 0.8); position: absolute; top: 0; left: 0; right: 0; z-index: 20; }
        .story-canvas-container { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; background: #000; }
        #story-canvas { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 100%; max-height: 100%; touch-action: none; }
        .story-canvas-tools { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.9); padding: 16px 20px; padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 20px); z-index: 20; }
        .story-tools-row { display: flex; justify-content: center; gap: 16px; margin-bottom: 12px; }
        .story-tool-btn { width: 48px; height: 48px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); border: 2px solid transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; }
        .story-tool-btn.active { background: rgba(197, 160, 89, 0.3); border-color: #C5A059; }
        .story-tool-btn svg { width: 24px; height: 24px; color: white; }
        .story-colors-row { display: flex; justify-content: center; gap: 12px; margin-bottom: 16px; }
        .story-color-btn { width: 32px; height: 32px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; transition: all 0.2s ease; }
        .story-color-btn.active { border-color: white; transform: scale(1.1); }
        .story-text-input-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 30; display: none; }
        .story-text-input-container.active { display: block; }
        .story-text-input { background: transparent; border: none; color: white; font-size: 32px; font-weight: 700; text-align: center; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); outline: none; min-width: 200px; padding: 8px; }
        .story-text-input::placeholder { color: rgba(255, 255, 255, 0.5); }
        .story-submit-btn { width: 100%; padding: 16px; border-radius: 50px; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; font-weight: 700; font-size: 16px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .story-brush-size { display: flex; justify-content: center; gap: 12px; margin-bottom: 12px; }
        .story-brush-btn { width: 28px; height: 28px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); border: 2px solid transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .story-brush-btn.active { border-color: #C5A059; }
        .story-brush-dot { background: white; border-radius: 50%; }
        .story-viewer { position: fixed; inset: 0; background: black; z-index: 700; display: none; flex-direction: column; }
        .story-viewer.active { display: flex; }
        .story-progress-container { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 12px); left: 12px; right: 12px; display: flex; gap: 4px; z-index: 10; }
        .story-progress-bar { flex: 1; height: 3px; background: rgba(255, 255, 255, 0.3); border-radius: 2px; overflow: hidden; }
        .story-progress-fill { height: 100%; background: white; width: 0%; transition: width 0.1s linear; }
        .story-progress-fill.active { animation: progress 10s linear forwards; }
        @keyframes progress { from { width: 0%; } to { width: 100%; } }
        .story-content { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .story-content img, .story-content video { width: 100%; height: 100%; object-fit: contain; }
        .story-nav { position: absolute; inset: 0; display: flex; }
        .story-nav-prev, .story-nav-next { flex: 1; cursor: pointer; }
        .story-header { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 30px); left: 16px; right: 16px; display: flex; align-items: center; gap: 12px; z-index: 10; }
        .story-avatar-small { width: 40px; height: 40px; border-radius: 50%; border: 2px solid white; object-fit: cover; }
        .story-user-info { color: white; text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5); }
        .story-close { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 30px); right: 16px; width: 36px; height: 36px; border-radius: 50%; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; z-index: 10; }
        .social-card { background: #FFFDF5; border-radius: 24px; margin: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(75, 54, 33, 0.06); }
        .post-media { width: 100%; aspect-ratio: 1; object-fit: cover; }
        .post-actions { display: flex; align-items: center; gap: 16px; padding: 12px 16px; border-top: 1px solid rgba(197, 160, 89, 0.1); }
        .post-action-btn { display: flex; align-items: center; gap: 6px; padding: 8px; border-radius: 50%; cursor: pointer; transition: all 0.2s; background: transparent; border: none; }
        .post-action-btn:hover { background: rgba(197, 160, 89, 0.1); }
        .post-action-btn svg { width: 24px; height: 24px; color: #8B7355; transition: all 0.2s; }
        .post-action-btn.liked svg { color: #EF4444; fill: #EF4444; }
        .post-action-btn.liked svg path { fill: #EF4444; }
        .post-action-count { font-size: 0.85rem; font-weight: 600; color: #4B3621; }
        .post-caption { padding: 0 16px 16px; }
        .post-caption-text { font-size: 0.95rem; color: #4B3621; }
        .post-caption-text .username { font-weight: 700; }
        .chat-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
        .chat-bubble { max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 0.95rem; line-height: 1.4; animation: fadeInUp 0.3s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .chat-bubble.bot { align-self: flex-start; background: #FFFDF5; color: #4B3621; border: 1px solid rgba(197, 160, 89, 0.2); border-bottom-left-radius: 4px; }
        .chat-bubble.user { align-self: flex-end; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; border-bottom-right-radius: 4px; }
        .chat-input-area { padding: 12px 16px calc(env(safe-area-inset-bottom, 0px) + 80px); background: #FFFDF5; border-top: 1px solid rgba(197, 160, 89, 0.15); }
        .chat-input-wrapper { display: flex; align-items: center; gap: 10px; background: #F9F7F2; border-radius: 50px; padding: 4px 4px 4px 16px; border: 1px solid rgba(197, 160, 89, 0.2); }
        .chat-input { flex: 1; border: none; background: transparent; font-size: 0.95rem; color: #4B3621; outline: none; padding: 10px 0; }
        .chat-send-btn { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .product-card { background: #FFFDF5; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 12px rgba(75, 54, 33, 0.05); }
        .category-pill { padding: 8px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 500; white-space: nowrap; cursor: pointer; }
        .category-pill.active { background: #C5A059; color: white; }
        .category-pill:not(.active) { background: #FFFDF5; color: #6D5D4E; border: 1px solid rgba(197, 160, 89, 0.2); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .grooming-header { background: linear-gradient(135deg, #FFFDF5 0%, #F5EFE0 100%); border-bottom: 1px solid rgba(197, 160, 89, 0.2); }
        .announcement-card { background: #FFFDF5; border: 1px solid rgba(197, 160, 89, 0.25); border-radius: 16px; padding: 16px; margin-bottom: 12px; }
        .portfolio-ring { width: 72px; height: 72px; border-radius: 50%; padding: 3px; background: linear-gradient(135deg, #D4AF37, #C5A059, #D4B896); }
        .portfolio-avatar { width: 100%; height: 100%; border-radius: 50%; border: 3px solid #FFFDF5; object-fit: cover; }
        .cta-button { background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; padding: 12px 24px; border-radius: 50px; font-weight: 600; box-shadow: 0 4px 16px rgba(197, 160, 89, 0.4); transition: all 0.3s ease; border: none; cursor: pointer; }
        .cta-button-gold { background: linear-gradient(135deg, #D4AF37 0%, #C5A059 50%, #B8941F 100%); color: white; padding: 16px 32px; border-radius: 50px; font-weight: 700; font-size: 1.1rem; box-shadow: 0 8px 32px rgba(212, 175, 55, 0.5); transition: all 0.3s ease; border: none; cursor: pointer; width: 100%; }
        .loading-overlay { position: fixed; inset: 0; background: rgba(249, 247, 242, 0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .loading-overlay.active { display: flex; }
        .loading-spinner { width: 48px; height: 48px; border: 4px solid #F0EAD6; border-top: 4px solid #C5A059; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(100px); background: #333; color: white; padding: 12px 24px; border-radius: 25px; font-size: 14px; z-index: 2000; opacity: 0; transition: all 0.3s ease; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: #22c55e; }
        .toast.error { background: #ef4444; }
        .toast.info { background: #3b82f6; }
        .header-centered { display: flex; justify-content: center; align-items: center; position: relative; padding: 12px 16px; padding-top: calc(env(safe-area-inset-top, 0px) + 12px); }
        .header-centered .header-title { text-align: center; }
        .header-centered .header-actions { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); margin-top: calc(env(safe-area-inset-top, 0px) / 2); }
        .profile-header-new { background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%); padding-top: calc(env(safe-area-inset-top, 0px) + 16px); padding-bottom: 24px; position: relative; }
        .profile-header-top { display: flex; justify-content: space-between; align-items: flex-start; padding: 0 16px 16px; }
        .profile-avatar-large { width: 90px; height: 90px; border-radius: 50%; border: 4px solid white; box-shadow: 0 4px 16px rgba(0,0,0,0.15); object-fit: cover; }
        .profile-header-actions { display: flex; gap: 12px; }
        .profile-icon-btn { width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; border: none; position: relative; }
        .profile-icon-btn:hover { background: white; transform: scale(1.05); }
        .profile-icon-btn .badge { position: absolute; top: -2px; right: -2px; width: 18px; height: 18px; background: #ef4444; color: white; font-size: 10px; font-weight: bold; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .profile-info { text-align: center; padding: 0 16px; }
        .profile-name { font-size: 1.25rem; font-weight: 700; color: #4B3621; margin-bottom: 4px; }
        .profile-pet-name { font-size: 0.9rem; color: #6D5D4E; }
        .profile-stats { display: flex; justify-content: center; gap: 32px; padding: 16px 0; }
        .profile-stat { text-align: center; cursor: pointer; transition: opacity 0.2s; }
        .profile-stat:hover { opacity: 0.8; }
        .profile-stat.active .stat-value { color: #C5A059; }
        .profile-stat .stat-value { font-size: 1.25rem; font-weight: 700; color: #4B3621; transition: color 0.2s; }
        .profile-stat .stat-label { font-size: 0.75rem; color: #8B7355; text-transform: uppercase; letter-spacing: 0.5px; }
        .profile-tabs { display: flex; border-bottom: 1px solid rgba(197, 160, 89, 0.2); background: white; }
        .profile-tab { flex: 1; padding: 12px; text-align: center; font-size: 0.85rem; font-weight: 500; color: #8B7355; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .profile-tab.active { color: #C5A059; border-bottom-color: #C5A059; }
        .profile-content { padding: 16px; min-height: 300px; }
        .posts-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; }
        .posts-grid-item { aspect-ratio: 1; overflow: hidden; cursor: pointer; }
        .posts-grid-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.2s; }
        .posts-grid-item:hover img { transform: scale(1.05); }
        .empty-state { text-align: center; padding: 48px 24px; color: #8B7355; }
        .empty-state svg { width: 64px; height: 64px; margin-bottom: 16px; opacity: 0.5; }
        .booking-item { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; border: 1px solid rgba(197, 160, 89, 0.15); }
        .booking-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .booking-service { font-weight: 600; color: #4B3621; }
        .booking-status { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: 500; }
        .booking-status.pendiente { background: #FEF3C7; color: #92400E; }
        .booking-status.confirmada { background: #D1FAE5; color: #065F46; }
        .booking-status.completada { background: #E5E7EB; color: #374151; }
        .booking-date { font-size: 0.85rem; color: #6D5D4E; display: flex; align-items: center; gap: 6px; }
        .pet-form { background: white; border-radius: 16px; padding: 20px; }
        .pet-form-group { margin-bottom: 16px; }
        .pet-form-label { display: block; font-size: 0.85rem; font-weight: 500; color: #4B3621; margin-bottom: 6px; }
        .pet-form-input { width: 100%; padding: 12px 16px; border: 1px solid rgba(197, 160, 89, 0.3); border-radius: 12px; font-size: 0.95rem; outline: none; transition: all 0.2s; }
        .pet-form-input:focus { border-color: #C5A059; box-shadow: 0 0 0 3px rgba(197, 160, 89, 0.1); }
        .pet-form-input:read-only { background: #F9F7F2; color: #8B7355; }
        .pet-avatar-upload { width: 100px; height: 100px; border-radius: 50%; border: 3px dashed rgba(197, 160, 89, 0.4); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; margin: 0 auto 20px; transition: all 0.2s; position: relative; overflow: hidden; }
        .pet-avatar-upload:hover { border-color: #C5A059; background: rgba(197, 160, 89, 0.05); }
        .pet-avatar-upload img { width: 100%; height: 100%; object-fit: cover; }
        .pet-avatar-upload .upload-icon { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.5); padding: 4px; text-align: center; }
        .pet-avatar-upload .upload-icon svg { width: 16px; height: 16px; color: white; }
        .side-menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 800; display: none; opacity: 0; transition: opacity 0.3s; }
        .side-menu-overlay.active { display: block; opacity: 1; }
        .side-menu { position: fixed; top: 0; right: 0; bottom: 0; width: 80%; max-width: 320px; background: white; z-index: 801; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); padding-top: calc(env(safe-area-inset-top, 0px) + 16px); }
        .side-menu.active { transform: translateX(0); }
        .side-menu-header { padding: 16px 20px; border-bottom: 1px solid rgba(197, 160, 89, 0.15); }
        .side-menu-title { font-size: 1.1rem; font-weight: 700; color: #4B3621; }
        .side-menu-item { display: flex; align-items: center; gap: 16px; padding: 16px 20px; cursor: pointer; transition: background 0.2s; border-bottom: 1px solid rgba(197, 160, 89, 0.08); }
        .side-menu-item:hover { background: rgba(197, 160, 89, 0.05); }
        .side-menu-item-icon { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .side-menu-item-icon.blue { background: #EFF6FF; color: #3B82F6; }
        .side-menu-item-icon.green { background: #ECFDF5; color: #10B981; }
        .side-menu-item-icon.purple { background: #F3E8FF; color: #8B5CF6; }
        .side-menu-item-icon.orange { background: #FFF7ED; color: #F97316; }
        .side-menu-item-icon.red { background: #FEF2F2; color: #EF4444; }
        .side-menu-item-text { flex: 1; }
        .side-menu-item-title { font-weight: 600; color: #4B3621; font-size: 0.95rem; }
        .side-menu-item-desc { font-size: 0.8rem; color: #8B7355; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 900; display: none; align-items: flex-end; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-sheet { background: white; width: 100%; max-height: 90vh; border-radius: 24px 24px 0 0; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); overflow-y: auto; }
        .modal-overlay.active .modal-sheet { transform: translateY(0); }
        .modal-header { padding: 20px; border-bottom: 1px solid rgba(197, 160, 89, 0.15); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: white; z-index: 10; }
        .modal-title { font-size: 1.1rem; font-weight: 700; color: #4B3621; }
        .modal-close { width: 36px; height: 36px; border-radius: 50%; border: none; background: #F9F7F2; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .modal-body { padding: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 0.85rem; font-weight: 500; color: #4B3621; margin-bottom: 8px; }
        .form-input { width: 100%; padding: 14px 16px; border: 1px solid rgba(197, 160, 89, 0.3); border-radius: 12px; font-size: 0.95rem; outline: none; transition: all 0.2s; }
        .form-input:focus { border-color: #C5A059; box-shadow: 0 0 0 3px rgba(197, 160, 89, 0.1); }
        .form-input:read-only { background: #F9F7F2; color: #8B7355; }
        .avatar-edit { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 20px; position: relative; cursor: pointer; }
        .avatar-edit img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .avatar-edit-overlay { position: absolute; inset: 0; border-radius: 50%; background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.2s; }
        .avatar-edit:hover .avatar-edit-overlay { opacity: 1; }
        .avatar-edit-overlay svg { width: 24px; height: 24px; color: white; }
        .comments-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 900; display: none; align-items: flex-end; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .comments-modal.active { display: flex; opacity: 1; }
        .comments-sheet { background: white; width: 100%; max-height: 80vh; border-radius: 24px 24px 0 0; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; display: flex; flex-direction: column; }
        .comments-modal.active .comments-sheet { transform: translateY(0); }
        .comments-header { padding: 20px; border-bottom: 1px solid rgba(197, 160, 89, 0.15); display: flex; justify-content: space-between; align-items: center; }
        .comments-title { font-size: 1.1rem; font-weight: 700; color: #4B3621; }
        .comments-list { flex: 1; overflow-y: auto; padding: 16px; }
        .comments-empty { text-align: center; padding: 48px 24px; color: #8B7355; }
        .comments-input-area { padding: 12px 16px calc(env(safe-area-inset-bottom, 0px) + 12px); background: #FFFDF5; border-top: 1px solid rgba(197, 160, 89, 0.15); }
        .comments-input-wrapper { display: flex; align-items: center; gap: 10px; background: #F9F7F2; border-radius: 50px; padding: 4px 4px 4px 16px; border: 1px solid rgba(197, 160, 89, 0.2); }
        .comments-input { flex: 1; border: none; background: transparent; font-size: 0.95rem; color: #4B3621; outline: none; padding: 10px 0; }
        .comments-submit-btn { padding: 10px 20px; border-radius: 50px; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; font-weight: 600; border: none; cursor: pointer; }
        .wizard-step { display: none; }
        .wizard-step.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .wizard-progress { display: flex; gap: 8px; margin-bottom: 24px; }
        .wizard-progress-bar { flex: 1; height: 4px; background: #E5E7EB; border-radius: 2px; overflow: hidden; }
        .wizard-progress-bar.fill { background: #C5A059; }
        .option-card { padding: 16px; border: 2px solid rgba(197, 160, 89, 0.2); border-radius: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
        .option-card:hover { border-color: rgba(197, 160, 89, 0.5); }
        .option-card.selected { border-color: #C5A059; background: rgba(197, 160, 89, 0.05); }
        .option-card-title { font-weight: 600; color: #4B3621; }
        .wizard-nav { display: flex; gap: 12px; margin-top: 24px; }
        .wizard-btn { flex: 1; padding: 14px; border-radius: 12px; font-weight: 600; cursor: pointer; border: none; transition: all 0.2s; }
        .wizard-btn.secondary { background: #F3F4F6; color: #4B3621; }
        .wizard-btn.secondary:hover { background: #E5E7EB; }
        .wizard-btn.primary { background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; }
        .wizard-btn.primary:hover { opacity: 0.9; }
        .wizard-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .notification-item { display: flex; gap: 12px; padding: 16px; border-bottom: 1px solid rgba(197, 160, 89, 0.1); cursor: pointer; transition: background 0.2s; }
        .notification-item:hover { background: rgba(197, 160, 89, 0.03); }
        .notification-item.unread { background: rgba(197, 160, 89, 0.05); }
        .notification-avatar { width: 44px; height: 44px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
        .notification-content { flex: 1; }
        .notification-text { font-size: 0.9rem; color: #4B3621; line-height: 1.4; }
        .notification-text strong { font-weight: 600; }
        .notification-time { font-size: 0.75rem; color: #8B7355; margin-top: 4px; }
        .notification-dot { width: 8px; height: 8px; background: #C5A059; border-radius: 50%; flex-shrink: 0; margin-top: 6px; }
        .alert-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 24px; }
        .alert-overlay.active { display: flex; }
        .alert-box { background: white; border-radius: 20px; padding: 24px; max-width: 320px; width: 100%; text-align: center; animation: scaleIn 0.2s; }
        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .alert-icon { width: 56px; height: 56px; background: #FEF2F2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
        .alert-icon svg { width: 28px; height: 28px; color: #EF4444; }
        .alert-title { font-size: 1.1rem; font-weight: 700; color: #4B3621; margin-bottom: 8px; }
        .alert-message { font-size: 0.9rem; color: #6D5D4E; margin-bottom: 20px; }
        .alert-buttons { display: flex; gap: 12px; }
        .alert-btn { flex: 1; padding: 12px; border-radius: 12px; font-weight: 600; cursor: pointer; border: none; }
        .alert-btn.cancel { background: #F3F4F6; color: #4B3621; }
        .alert-btn.confirm { background: #EF4444; color: white; }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- SCREEN: LOGIN -->
        <div id="screen-login" class="screen login-screen active">
            <div class="text-center mb-8">
                <div class="login-logo">
                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" />
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-[#4B3621] font-serif mb-2">Maria's Cut</h1>
                <p class="text-[#6D5D4E]">Peluqueria Canina Premium</p>
            </div>
            <div class="space-y-3">
                <input type="email" id="login-email" class="login-input" placeholder="Correo electronico">
                <input type="password" id="login-password" class="login-input" placeholder="Contrasena">
                <div id="register-fields" class="hidden space-y-3">
                    <input type="text" id="login-name" class="login-input" placeholder="Tu nombre">
                    <input type="text" id="login-pet" class="login-input" placeholder="Nombre de tu mascota">
                    <input type="tel" id="login-phone" class="login-input" placeholder="Telefono">
                </div>
                <div id="login-actions">
                    <button id="btn-login" class="login-btn">Iniciar Sesion</button>
                    <button id="btn-show-register" class="login-btn-secondary text-sm mt-2">No tienes cuenta? Registrate aqui</button>
                </div>
                <div id="register-actions" class="hidden">
                    <button id="btn-register" class="login-btn">Registrarse</button>
                    <button id="btn-show-login" class="login-btn-secondary text-sm mt-2">Ya tienes cuenta? Inicia Sesion</button>
                </div>
                <button id="btn-skip" class="text-[#8B7355] text-xs font-semibold mt-6 underline hover:text-[#4B3621] transition-colors">Entrar como Invitado</button>
            </div>
            <p id="login-error" class="text-red-600 text-sm text-center mt-4 hidden bg-white/80 p-2 rounded-lg"></p>
        </div>

        <!-- SCREEN: HOME -->
        <div id="screen-home" class="screen hidden">
            <div class="header-gradient header-centered">
                <div class="header-title">
                    <h1 class="text-lg font-bold text-[#4B3621]">Maria's Social Club</h1>
                    <p class="text-xs text-[#C5A059] font-medium">Comunidad Exclusiva</p>
                </div>
                <div class="header-actions">
                    <button id="btn-add-content" class="w-9 h-9 bg-white/50 rounded-full flex items-center justify-center hover:bg-white/70 transition-colors">
                        <svg class="w-5 h-5 text-[#4B3621]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="screen-content">
                <div class="stories-rail" id="stories-container"></div>
                <div id="feed-container"></div>
            </div>
        </div>

        <!-- SCREEN: SHOP -->
        <div id="screen-shop" class="screen hidden">
            <div class="safe-header px-4 flex justify-between items-center">
                <h1 class="text-lg font-bold text-[#4B3621]">Boutique</h1>
            </div>
            <div class="screen-content">
                <div class="grid grid-cols-2 gap-3 px-4 pb-4">
                    <div class="product-card">
                        <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1589924691195-41432c84c161?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                        </div>
                        <div class="p-3">
                            <h3 class="text-sm font-medium text-[#4B3621]">Perrarina Premium</h3>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-[#C5A059] font-bold">$54.99</span>
                            </div>
                        </div>
                    </div>
                    <div class="product-card">
                        <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1576201836106-db1758fd1c97?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                        </div>
                        <div class="p-3">
                            <h3 class="text-sm font-medium text-[#4B3621]">Collar GPS</h3>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-[#C5A059] font-bold">$129.99</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCREEN: GROOMING -->
        <div id="screen-grooming" class="screen hidden">
            <div class="safe-header grooming-header px-4 flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold text-[#4B3621] font-serif">El Studio de Maria</h1>
                    <p class="text-xs text-[#C5A059] font-medium">Peluqueria Canina Premium</p>
                </div>
                <button id="btn-booking" class="cta-button flex items-center gap-2 text-sm">Agendar Cita</button>
            </div>
            <div class="screen-content">
                <div class="bg-white py-4">
                    <div class="px-4 mb-3">
                        <h2 class="text-sm font-bold text-[#4B3621] uppercase tracking-wide">Trabajos Recientes</h2>
                    </div>
                    <div class="flex overflow-x-auto gap-4 px-4 pb-2 no-scrollbar">
                        <div class="flex flex-col items-center flex-shrink-0">
                            <div class="portfolio-ring"><img src="https://images.unsplash.com/photo-1518717758536-85ae29035b6d?w=200&h=200&fit=crop" class="portfolio-avatar"></div>
                            <span class="text-xs text-[#4B3621] mt-2 font-medium">Luna</span>
                        </div>
                        <div class="flex flex-col items-center flex-shrink-0">
                            <div class="portfolio-ring"><img src="https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=200&h=200&fit=crop" class="portfolio-avatar"></div>
                            <span class="text-xs text-[#4B3621] mt-2 font-medium">Max</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCREEN: ASSISTANT -->
        <div id="screen-assistant" class="screen hidden">
            <div class="safe-header px-4 flex justify-between items-center">
                <h1 class="text-lg font-bold text-[#4B3621]">Asistente</h1>
            </div>
            <div class="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-bubble bot">¬°Hola! Soy el asistente de Maria's Cut. ¬øEn que puedo ayudarte?</div>
                </div>
                <div class="chat-input-area">
                    <div class="chat-input-wrapper">
                        <input type="text" id="chat-input" class="chat-input" placeholder="Escribe tu mensaje...">
                        <button id="btn-send-chat" class="chat-send-btn">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCREEN: PROFILE -->
        <div id="screen-profile" class="screen hidden">
            <div class="profile-header-new">
                <div class="profile-header-top">
                    <img id="profile-avatar" src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop" class="profile-avatar-large">
                    <div class="profile-header-actions">
                        <button id="btn-notifications" class="profile-icon-btn">
                            <svg class="w-5 h-5 text-[#4B3621]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                            </svg>
                            <span class="badge" id="notif-badge">3</span>
                        </button>
                        <button id="btn-menu" class="profile-icon-btn">
                            <svg class="w-5 h-5 text-[#4B3621]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="profile-info">
                    <h2 id="profile-name" class="profile-name">Usuario</h2>
                    <p id="profile-pet" class="profile-pet-name"></p>
                    <div class="profile-stats">
                        <div class="profile-stat" data-tab="posts">
                            <div class="stat-value" id="stat-posts">0</div>
                            <div class="stat-label">Posts</div>
                        </div>
                        <div class="profile-stat" data-tab="bookings">
                            <div class="stat-value" id="stat-bookings">0</div>
                            <div class="stat-label">Citas</div>
                        </div>
                        <div class="profile-stat" data-tab="pet">
                            <div class="stat-value" id="stat-pet">üêï</div>
                            <div class="stat-label">Mascota</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="profile-tabs">
                <div class="profile-tab active" data-tab="posts">Publicaciones</div>
                <div class="profile-tab" data-tab="bookings">Citas</div>
                <div class="profile-tab" data-tab="pet">Mascota</div>
            </div>
            <div class="profile-content">
                <div id="tab-posts" class="tab-content">
                    <div class="posts-grid" id="profile-posts-grid"></div>
                    <div class="empty-state" id="posts-empty">
                        <p class="text-sm">Aun no hay publicaciones</p>
                    </div>
                </div>
                <div id="tab-bookings" class="tab-content hidden">
                    <div id="bookings-list"></div>
                </div>
                <div id="tab-pet" class="tab-content hidden">
                    <div class="pet-form">
                        <div class="pet-avatar-upload" id="pet-avatar-upload">
                            <img id="pet-avatar-img" src="https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=200&h=200&fit=crop" class="hidden">
                            <div class="upload-icon" id="pet-upload-icon">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /></svg>
                            </div>
                        </div>
                        <input type="file" id="pet-avatar-input" class="hidden" accept="image/*">
                        <div class="pet-form-group"><label class="pet-form-label">Nombre</label><input type="text" id="pet-name-input" class="pet-form-input" placeholder="Ej: Luna"></div>
                        <div class="pet-form-group"><label class="pet-form-label">Raza</label><input type="text" id="pet-breed-input" class="pet-form-input" placeholder="Ej: Golden"></div>
                        <button id="btn-save-pet" class="login-btn">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SIDE MENU -->
        <div id="side-menu-overlay" class="side-menu-overlay"></div>
        <div id="side-menu" class="side-menu">
            <div class="side-menu-header"><h3 class="side-menu-title">Ajustes</h3></div>
            <div class="side-menu-item" id="menu-mis-datos">
                <div class="side-menu-item-icon blue"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg></div>
                <div class="side-menu-item-text"><div class="side-menu-item-title">Mis Datos</div></div>
            </div>
            <div class="side-menu-item" id="menu-entrenador">
                <div class="side-menu-item-icon green"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg></div>
                <div class="side-menu-item-text"><div class="side-menu-item-title">Hacerme Entrenador</div></div>
            </div>
            <div class="side-menu-item" id="menu-paseador">
                <div class="side-menu-item-icon purple"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                <div class="side-menu-item-text"><div class="side-menu-item-title">Hacerme Paseador</div></div>
            </div>
            <div class="side-menu-item" id="menu-logout">
                <div class="side-menu-item-icon red"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg></div>
                <div class="side-menu-item-text"><div class="side-menu-item-title">Cerrar Sesion</div></div>
            </div>
        </div>

        <!-- MODAL: MIS DATOS -->
        <div id="modal-mis-datos" class="modal-overlay">
            <div class="modal-sheet">
                <div class="modal-header">
                    <h3 class="modal-title">Mis Datos</h3>
                    <button id="btn-close-mis-datos" class="modal-close"><svg class="w-5 h-5 text-[#8B7355]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                </div>
                <div class="modal-body">
                    <div class="form-group"><label class="form-label">Nombre</label><input type="text" id="edit-name" class="form-input"></div>
                    <div class="form-group"><label class="form-label">Telefono</label><input type="tel" id="edit-phone" class="form-input"></div>
                    <div class="form-group"><label class="form-label">Correo</label><input type="email" id="edit-email" class="form-input" readonly></div>
                    <button id="btn-save-datos" class="login-btn">Guardar Cambios</button>
                </div>
            </div>
        </div>

        <!-- MODAL: WIZARD -->
        <div id="modal-wizard" class="modal-overlay">
            <div class="modal-sheet">
                <div class="modal-header">
                    <h3 class="modal-title" id="wizard-title">Solicitud</h3>
                    <button id="btn-close-wizard" class="modal-close"><svg class="w-5 h-5 text-[#8B7355]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                </div>
                <div class="modal-body">
                    <div class="wizard-progress">
                        <div class="wizard-progress-bar fill" id="progress-1"></div>
                        <div class="wizard-progress-bar" id="progress-2"></div>
                        <div class="wizard-progress-bar" id="progress-3"></div>
                    </div>
                    <div class="wizard-step active" id="step-1">
                        <h4 class="text-lg font-semibold text-[#4B3621] mb-4">¬øExperiencia?</h4>
                        <div class="option-card" data-value="0-1"><div class="option-card-title">0 - 1 ano</div></div>
                        <div class="option-card" data-value="2-5"><div class="option-card-title">2 - 5 anos</div></div>
                        <div class="option-card" data-value="+5"><div class="option-card-title">Mas de 5</div></div>
                    </div>
                    <div class="wizard-step" id="step-2">
                        <h4 class="text-lg font-semibold text-[#4B3621] mb-4">¬øCertificacion?</h4>
                        <div class="option-card" data-value="si"><div class="option-card-title">Si</div></div>
                        <div class="option-card" data-value="no"><div class="option-card-title">No</div></div>
                    </div>
                    <div class="wizard-step" id="step-3">
                        <h4 class="text-lg font-semibold text-[#4B3621] mb-4">¬øSobre ti?</h4>
                        <textarea id="wizard-about" class="post-editor-input" rows="5"></textarea>
                    </div>
                    <div class="wizard-nav">
                        <button class="wizard-btn secondary" id="wizard-prev">Anterior</button>
                        <button class="wizard-btn primary" id="wizard-next">Siguiente</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL: NOTIFICACIONES -->
        <div id="modal-notifications" class="modal-overlay">
            <div class="modal-sheet">
                <div class="modal-header">
                    <h3 class="modal-title">Notificaciones</h3>
                    <button id="btn-close-notifications" class="modal-close"><svg class="w-5 h-5 text-[#8B7355]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                </div>
                <div class="modal-body" id="notifications-list"></div>
            </div>
        </div>

        <!-- MODAL: COMENTARIOS -->
        <div id="modal-comments" class="comments-modal">
            <div class="comments-sheet">
                <div class="comments-header">
                    <h3 class="comments-title">Comentarios</h3>
                    <button id="btn-close-comments" class="modal-close"><svg class="w-5 h-5 text-[#8B7355]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                </div>
                <div class="comments-list" id="comments-list"></div>
                <div class="comments-input-area">
                    <div class="comments-input-wrapper">
                        <input type="text" id="comment-input" class="comments-input" placeholder="Escribe un comentario...">
                        <button id="btn-submit-comment" class="comments-submit-btn">Publicar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ALERT: LOGOUT -->
        <div id="alert-logout" class="alert-overlay">
            <div class="alert-box">
                <div class="alert-icon"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="w-7 h-7"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg></div>
                <h4 class="alert-title">¬øCerrar sesion?</h4>
                <div class="alert-buttons">
                    <button id="btn-cancel-logout" class="alert-btn cancel">Cancelar</button>
                    <button id="confirm-logout" class="alert-btn confirm">Cerrar Sesion</button>
                </div>
            </div>
        </div>

        <!-- BOTTOM NAVIGATION -->
        <nav id="bottom-nav" class="bottom-nav hidden">
            <div class="nav-container">
                <div class="nav-item" data-screen="screen-home">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" /></svg>
                    <span class="text-xs mt-1">Club</span>
                </div>
                <div class="nav-item" data-screen="screen-shop">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                    <span class="text-xs mt-1">Tienda</span>
                </div>
                <div class="nav-center-btn" data-screen="screen-grooming">
                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" /></svg>
                    <span class="nav-center-label">Peluqueria</span>
                </div>
                <div class="nav-item" data-screen="screen-assistant">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                    <span class="text-xs mt-1">Asistente</span>
                </div>
                <div class="nav-item" data-screen="screen-profile">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                    <span class="text-xs mt-1">Perfil</span>
                </div>
            </div>
        </nav>

        <!-- CAMERA OVERLAY -->
        <div id="camera-overlay" class="camera-overlay">
            <div class="camera-preview">
                <video id="camera-video" class="camera-video" autoplay playsinline></video>
                <canvas id="camera-canvas" class="camera-canvas"></canvas>
                <button id="camera-close" class="camera-btn-close">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="camera-controls">
                <div class="camera-btn-gallery" id="camera-gallery-btn">
                    <img src="https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=100&h=100&fit=crop">
                </div>
                <button id="camera-capture" class="camera-btn-capture"></button>
                <div style="width: 50px;"></div>
            </div>
        </div>

        <!-- POST EDITOR -->
        <div id="post-editor-modal" class="post-editor-modal">
            <div class="post-editor-header">
                <button id="editor-cancel" class="text-white font-medium">Cancelar</button>
                <span class="text-white font-semibold">Nueva Publicacion</span>
                <div style="width: 60px;"></div>
            </div>
            <div class="post-editor-preview">
                <img id="editor-preview-img" src="" class="hidden">
                <video id="editor-preview-video" class="hidden" controls playsinline></video>
            </div>
            <div class="post-editor-footer">
                <textarea id="editor-caption" class="post-editor-input" rows="2" placeholder="Escribe un pie de foto..."></textarea>
                <button id="editor-submit" class="post-editor-submit">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
                    Publicar
                </button>
            </div>
        </div>

        <!-- STORY VIEWER -->
        <div id="story-viewer" class="story-viewer">
            <div class="story-progress-container" id="story-progress-container"></div>
            <div class="story-header">
                <img id="story-viewer-avatar" src="" class="story-avatar-small">
                <div class="story-user-info">
                    <p id="story-viewer-name" class="font-semibold"></p>
                </div>
            </div>
            <button id="story-close" class="story-close">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div class="story-content">
                <img id="story-viewer-media" src="" class="hidden">
            </div>
            <div class="story-nav">
                <div id="story-nav-prev" class="story-nav-prev"></div>
                <div id="story-nav-next" class="story-nav-next"></div>
            </div>
        </div>

        <!-- LOADING OVERLAY -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p id="loading-text" class="mt-4 text-[#4B3621] font-medium">Cargando...</p>
        </div>

        <!-- TOAST -->
        <div id="toast" class="toast"></div>

        <!-- Hidden file inputs -->
        <input type="file" id="gallery-input" class="hidden" accept="image/*,video/*">
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInAnonymously, signOut, updateProfile } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, updateDoc, arrayUnion, arrayRemove, limit } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBTJ1Gf__zEpi9SkA1LkJ8pYz4Jb0zkU8A",
            authDomain: "maria-s-cut.firebaseapp.com",
            projectId: "maria-s-cut",
            storageBucket: "maria-s-cut.firebasestorage.app",
            messagingSenderId: "387590858198",
            appId: "1:387590858198:web:0848e746b595543f0af077"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        const AppState = {
            currentUser: null, userData: null, isGuest: false,
            currentScreen: 'login', cameraMode: 'story', capturedMedia: null,
            storiesByUser: {}, storyUsers: [], currentStoryIndex: 0,
            currentPostId: null, wizardStep: 1, wizardAnswers: {},
            feedUnsubscribe: null, storiesUnsubscribe: null, mediaStream: null
        };

        function showLoading(text = 'Cargando...') {
            const overlay = document.getElementById('loading-overlay');
            const textEl = document.getElementById('loading-text');
            if (overlay && textEl) { textEl.textContent = text; overlay.classList.add('active'); }
        }
        function hideLoading() { document.getElementById('loading-overlay')?.classList.remove('active'); }
        function showToast(message, type = 'default') {
            const toast = document.getElementById('toast');
            if (toast) { toast.textContent = message; toast.className = 'toast show ' + type; setTimeout(() => toast.classList.remove('show'), 3000); }
        }
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => { s.classList.add('hidden'); s.classList.remove('active'); });
            const target = document.getElementById(screenId);
            if (target) { target.classList.remove('hidden'); target.classList.add('active'); AppState.currentScreen = screenId; }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // AUTH BUTTONS
            const loginActions = document.getElementById('login-actions');
            const registerActions = document.getElementById('register-actions');
            const registerFields = document.getElementById('register-fields');
            const errorEl = document.getElementById('login-error');

            function showAuthError(msg) { if (errorEl) { errorEl.textContent = msg; errorEl.classList.remove('hidden'); } }
            function hideAuthError() { if (errorEl) errorEl.classList.add('hidden'); }

            document.getElementById('btn-show-register')?.addEventListener('click', () => {
                loginActions?.classList.add('hidden'); registerActions?.classList.remove('hidden'); registerFields?.classList.remove('hidden'); hideAuthError();
            });
            document.getElementById('btn-show-login')?.addEventListener('click', () => {
                registerActions?.classList.add('hidden'); loginActions?.classList.remove('hidden'); registerFields?.classList.add('hidden'); hideAuthError();
            });
            document.getElementById('btn-login')?.addEventListener('click', async () => {
                const email = document.getElementById('login-email')?.value.trim();
                const password = document.getElementById('login-password')?.value;
                if (!email || !password) { showAuthError('Ingresa email y contrasena'); return; }
                showLoading('Iniciando sesion...'); hideAuthError();
                try { await signInWithEmailAndPassword(auth, email, password); } catch (error) {
                    hideLoading();
                    if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password') showAuthError('Usuario o contrasena incorrectos');
                    else if (error.code === 'auth/invalid-email') showAuthError('Email invalido');
                    else showAuthError('Error: ' + error.message);
                }
            });
            document.getElementById('btn-register')?.addEventListener('click', async () => {
                const email = document.getElementById('login-email')?.value.trim();
                const password = document.getElementById('login-password')?.value;
                const name = document.getElementById('login-name')?.value.trim();
                const pet = document.getElementById('login-pet')?.value.trim();
                const phone = document.getElementById('login-phone')?.value.trim();
                if (!email || !password || !name) { showAuthError('Email, contrasena y nombre son obligatorios'); return; }
                if (password.length < 6) { showAuthError('La contrasena debe tener al menos 6 caracteres'); return; }
                showLoading('Creando cuenta...'); hideAuthError();
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await setDoc(doc(db, 'users', userCredential.user.uid), { name, email, petName: pet || 'Mi Mascota', phone: phone || '', createdAt: serverTimestamp() });
                    await updateProfile(userCredential.user, { displayName: name });
                    showToast('¬°Cuenta creada!', 'success');
                } catch (error) {
                    hideLoading();
                    if (error.code === 'auth/email-already-in-use') showAuthError('Este correo ya esta registrado');
                    else showAuthError('Error: ' + error.message);
                }
            });
            document.getElementById('btn-skip')?.addEventListener('click', async () => {
                showLoading('Entrando como invitado...');
                try { AppState.isGuest = true; await signInAnonymously(auth); } catch (error) { hideLoading(); showToast('Error al entrar como invitado', 'error'); AppState.isGuest = false; }
            });

            // MODALS
            window.openModal = (id) => document.getElementById(id)?.classList.add('active');
            window.closeModal = (id) => document.getElementById(id)?.classList.remove('active');
            window.openAlert = (id) => document.getElementById(id)?.classList.add('active');
            window.closeAlert = (id) => document.getElementById(id)?.classList.remove('active');

            document.getElementById('btn-close-mis-datos')?.addEventListener('click', () => closeModal('modal-mis-datos'));
            document.getElementById('btn-close-wizard')?.addEventListener('click', () => closeModal('modal-wizard'));
            document.getElementById('btn-close-notifications')?.addEventListener('click', () => closeModal('modal-notifications'));
            document.getElementById('btn-close-comments')?.addEventListener('click', () => closeModal('modal-comments'));
            document.getElementById('btn-cancel-logout')?.addEventListener('click', () => closeAlert('alert-logout'));

            // NAVIGATION
            document.querySelectorAll('.nav-item, .nav-center-btn').forEach(item => {
                item.addEventListener('click', () => { const screenId = item.dataset.screen; if (screenId) showScreen(screenId); });
            });
            document.getElementById('btn-booking')?.addEventListener('click', () => showToast('Proximamente disponible', 'info'));

            // AUTH STATE
            onAuthStateChanged(auth, async (user) => {
                if (!user && !AppState.isGuest) {
                    AppState.currentUser = null; AppState.userData = null; showScreen('screen-login');
                    document.getElementById('bottom-nav')?.classList.add('hidden'); hideLoading(); return;
                }
                AppState.currentUser = user;
                if (user && !AppState.isGuest) {
                    showLoading('Cargando...');
                    try {
                        const userDoc = await getDoc(doc(db, 'users', user.uid));
                        if (userDoc.exists()) { AppState.userData = userDoc.data(); document.getElementById('profile-name').textContent = AppState.userData.name || 'Usuario'; }
                    } catch (e) {}
                    showScreen('screen-grooming');
                    document.getElementById('bottom-nav')?.classList.remove('hidden');
                    hideLoading();
                    loadFeed(); loadStories();
                } else {
                    AppState.userData = { name: 'Invitado', petName: '' };
                    showScreen('screen-grooming');
                    document.getElementById('bottom-nav')?.classList.remove('hidden');
                    hideLoading();
                }
            });

            // MENU
            document.getElementById('btn-menu')?.addEventListener('click', () => { document.getElementById('side-menu-overlay')?.classList.add('active'); document.getElementById('side-menu')?.classList.add('active'); });
            document.getElementById('side-menu-overlay')?.addEventListener('click', () => { document.getElementById('side-menu-overlay')?.classList.remove('active'); document.getElementById('side-menu')?.classList.remove('active'); });
            document.getElementById('menu-mis-datos')?.addEventListener('click', () => { document.getElementById('side-menu-overlay')?.classList.remove('active'); document.getElementById('side-menu')?.classList.remove('active'); openModal('modal-mis-datos'); });
            document.getElementById('menu-logout')?.addEventListener('click', () => { document.getElementById('side-menu-overlay')?.classList.remove('active'); document.getElementById('side-menu')?.classList.remove('active'); openAlert('alert-logout'); });
            document.getElementById('confirm-logout')?.addEventListener('click', async () => { closeAlert('alert-logout'); try { await signOut(auth); AppState.isGuest = false; AppState.currentUser = null; } catch (e) {} });

            // TABS
            document.querySelectorAll('.profile-tab, .profile-stat').forEach(tab => {
                tab.addEventListener('click', () => { const tabName = tab.dataset.tab; document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden')); document.querySelector(`.profile-tab[data-tab="${tabName}"]`)?.classList.add('active'); document.getElementById(`tab-${tabName}`)?.classList.remove('hidden'); });
            });

            // WIZARD
            document.getElementById('menu-entrenador')?.addEventListener('click', () => { document.getElementById('side-menu-overlay')?.classList.remove('active'); document.getElementById('side-menu')?.classList.remove('active'); startWizard('entrenador'); });
            document.getElementById('menu-paseador')?.addEventListener('click', () => { document.getElementById('side-menu-overlay')?.classList.remove('active'); document.getElementById('side-menu')?.classList.remove('active'); startWizard('paseador'); });
            function startWizard(type) { AppState.wizardType = type; AppState.wizardStep = 1; AppState.wizardAnswers = {}; document.getElementById('wizard-title').textContent = type === 'entrenador' ? 'Solicitud de Entrenador' : 'Solicitud de Paseador'; updateWizardUI(); openModal('modal-wizard'); }
            function updateWizardUI() { for (let i = 1; i <= 3; i++) document.getElementById(`progress-${i}`)?.classList.toggle('fill', i <= AppState.wizardStep); document.querySelectorAll('.wizard-step').forEach((step, index) => step.classList.toggle('active', index + 1 === AppState.wizardStep)); document.getElementById('wizard-prev').style.visibility = AppState.wizardStep === 1 ? 'hidden' : 'visible'; document.getElementById('wizard-next').textContent = AppState.wizardStep === 3 ? 'Finalizar' : 'Siguiente'; }
            document.getElementById('wizard-prev')?.addEventListener('click', () => { if (AppState.wizardStep > 1) { AppState.wizardStep--; updateWizardUI(); } });
            document.getElementById('wizard-next')?.addEventListener('click', async () => { const currentStepEl = document.getElementById(`step-${AppState.wizardStep}`); if (AppState.wizardStep < 3) { const selected = currentStepEl?.querySelector('.option-card.selected'); if (!selected) { showToast('Selecciona una opcion', 'info'); return; } AppState.wizardAnswers[`pregunta${AppState.wizardStep}`] = selected.dataset.value; } else AppState.wizardAnswers.about = document.getElementById('wizard-about')?.value; if (AppState.wizardStep === 3) { showLoading('Enviando...'); try { await addDoc(collection(db, 'solicitudes_staff'), { uid: AppState.currentUser.uid, tipo: AppState.wizardType, respuestas: AppState.wizardAnswers, estado: 'pendiente', userName: AppState.userData?.name || '', userEmail: AppState.currentUser.email, createdAt: serverTimestamp() }); showToast('¬°Solicitud enviada!', 'success'); closeModal('modal-wizard'); } catch (error) { showToast('Error al enviar', 'error'); } finally { hideLoading(); } } else { AppState.wizardStep++; updateWizardUI(); } });
            document.querySelectorAll('.option-card').forEach(card => { card.addEventListener('click', function() { this.parentElement?.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected')); this.classList.add('selected'); }); });

            // FEED PUBLICO
            function loadFeed() {
                const feedContainer = document.getElementById('feed-container');
                if (!feedContainer) return;
                const q = query(collection(db, 'posts'), orderBy('createdAt', 'desc'), limit(50));
                if (AppState.feedUnsubscribe) AppState.feedUnsubscribe();
                AppState.feedUnsubscribe = onSnapshot(q, (snapshot) => {
                    let html = '';
                    snapshot.forEach(docSnap => {
                        const post = docSnap.data(), postId = docSnap.id;
                        const likes = post.likes || [], comments = post.comments || [];
                        const isLiked = AppState.currentUser && likes.includes(AppState.currentUser.uid);
                        html += `<div class="social-card" data-post-id="${postId}"><div class="p-3 flex items-center gap-3"><img src="${post.userPhoto || 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop'}" class="w-10 h-10 rounded-full object-cover"><div class="flex-1"><p class="font-semibold text-[#4B3621] text-sm">${post.userName || 'Usuario'}</p></div></div><img src="${post.mediaUrl}" class="post-media" loading="lazy"><div class="post-actions"><button class="post-action-btn ${isLiked ? 'liked' : ''}" data-action="like" data-post-id="${postId}"><svg fill="${isLiked ? '#EF4444' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg><span class="post-action-count">${likes.length}</span></button><button class="post-action-btn" data-action="comment" data-post-id="${postId}"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg><span class="post-action-count">${comments.length}</span></button></div><div class="post-caption"><p class="post-caption-text"><span class="username">${post.userName || 'Usuario'}</span> ${post.caption || ''}</p></div></div>`;
                    });
                    feedContainer.innerHTML = html || '<div class="empty-state"><p>Aun no hay publicaciones</p></div>';
                    feedContainer.querySelectorAll('[data-action="like"]').forEach(btn => btn.addEventListener('click', () => handleLike(btn.dataset.postId)));
                    feedContainer.querySelectorAll('[data-action="comment"]').forEach(btn => btn.addEventListener('click', () => openComments(btn.dataset.postId)));
                });
            }
            async function handleLike(postId) { if (AppState.isGuest) { showToast('Registrate para dar like', 'info'); return; } if (!AppState.currentUser) return; try { const postRef = doc(db, 'posts', postId), postDoc = await getDoc(postRef); if (!postDoc.exists()) return; const likes = postDoc.data().likes || []; if (likes.includes(AppState.currentUser.uid)) await updateDoc(postRef, { likes: arrayRemove(AppState.currentUser.uid) }); else await updateDoc(postRef, { likes: arrayUnion(AppState.currentUser.uid) }); } catch (e) {} }
            function openComments(postId) { if (AppState.isGuest) { showToast('Registrate para comentar', 'info'); return; } AppState.currentPostId = postId; openModal('modal-comments'); loadComments(postId); }
            async function loadComments(postId) { const container = document.getElementById('comments-list'); if (!container) return; const postDoc = await getDoc(doc(db, 'posts', postId)); const comments = postDoc.data()?.comments || []; if (comments.length === 0) { container.innerHTML = '<div class="comments-empty"><p>Aun no hay comentarios</p></div>'; return; } container.innerHTML = comments.map(c => `<div class="flex gap-3 mb-4"><div class="flex-1"><p class="font-semibold text-sm text-[#4B3621]">${c.userName || 'Usuario'}</p><p class="text-[#6D5D4E] text-sm">${c.text}</p></div></div>`).join(''); }
            document.getElementById('btn-submit-comment')?.addEventListener('click', async () => { const input = document.getElementById('comment-input'); const text = input?.value.trim(); if (!text || !AppState.currentPostId) return; try { await updateDoc(doc(db, 'posts', AppState.currentPostId), { comments: arrayUnion({ userId: AppState.currentUser.uid, userName: AppState.userData?.name || 'Usuario', text, createdAt: new Date().toISOString() }) }); input.value = ''; loadComments(AppState.currentPostId); } catch (e) { showToast('Error al comentar', 'error'); } });

            // STORIES
            function loadStories() { const container = document.getElementById('stories-container'); if (!container) return; const q = query(collection(db, 'stories'), orderBy('createdAt', 'desc'), limit(100)); if (AppState.storiesUnsubscribe) AppState.storiesUnsubscribe(); AppState.storiesUnsubscribe = onSnapshot(q, (snapshot) => { const stories = []; snapshot.forEach(doc => stories.push({ id: doc.id, ...doc.data() })); const cutoff = Date.now() - 24 * 60 * 60 * 1000; const validStories = stories.filter(s => (s.createdAt?.toMillis?.() || 0) > cutoff); const byUser = {}; validStories.forEach(s => { if (!byUser[s.userId]) byUser[s.userId] = []; byUser[s.userId].push(s); }); AppState.storiesByUser = byUser; AppState.storyUsers = Object.keys(byUser); let html = '<div class="story-item" id="btn-add-story"><div class="story-avatar-ring"><img src="' + (AppState.userData?.photoURL || 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop') + '" class="story-avatar"></div><span class="text-xs text-[#4B3621] mt-1">Tu historia</span></div>'; Object.entries(byUser).forEach(([userId, userStories]) => { const story = userStories[0]; html += `<div class="story-item" data-story-user="${userId}"><div class="story-avatar-ring has-stories"><img src="${story.userPhoto || 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop'}" class="story-avatar"></div><span class="text-xs text-[#4B3621] mt-1">${story.userName?.split(' ')[0] || 'Usuario'}</span></div>`; }); container.innerHTML = html; document.getElementById('btn-add-story')?.addEventListener('click', () => { if (AppState.isGuest) { showToast('Registrate para publicar', 'info'); return; } startCamera(); }); container.querySelectorAll('[data-story-user]').forEach(item => item.addEventListener('click', () => { const userId = item.dataset.storyUser; const index = AppState.storyUsers.indexOf(userId); if (index !== -1) openStoryViewer(index); })); }); }
            function openStoryViewer(index) { AppState.currentStoryIndex = index; const userId = AppState.storyUsers[index]; const stories = AppState.storiesByUser[userId]; if (!stories || stories.length === 0) return; const story = stories[0]; document.getElementById('story-viewer')?.classList.add('active'); document.getElementById('story-viewer-avatar').src = story.userPhoto || 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop'; document.getElementById('story-viewer-name').textContent = story.userName || 'Usuario'; document.getElementById('story-viewer-media').src = story.mediaUrl; document.getElementById('story-viewer-media').classList.remove('hidden'); }
            document.getElementById('story-close')?.addEventListener('click', () => document.getElementById('story-viewer')?.classList.remove('active'));
            document.getElementById('story-nav-next')?.addEventListener('click', () => { if (AppState.currentStoryIndex < AppState.storyUsers.length - 1) openStoryViewer(AppState.currentStoryIndex + 1); else document.getElementById('story-viewer')?.classList.remove('active'); });
            document.getElementById('story-nav-prev')?.addEventListener('click', () => { if (AppState.currentStoryIndex > 0) openStoryViewer(AppState.currentStoryIndex - 1); });

            // CAMERA
            const cameraOverlay = document.getElementById('camera-overlay');
            const cameraVideo = document.getElementById('camera-video');
            async function startCamera() { if (AppState.isGuest) { showToast('Registrate para publicar', 'info'); return; } try { AppState.mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false }); cameraVideo.srcObject = AppState.mediaStream; cameraOverlay?.classList.add('active'); } catch (error) { document.getElementById('gallery-input')?.click(); } }
            function stopCamera() { if (AppState.mediaStream) { AppState.mediaStream.getTracks().forEach(track => track.stop()); AppState.mediaStream = null; } cameraOverlay?.classList.remove('active'); }
            document.getElementById('btn-add-content')?.addEventListener('click', () => { if (AppState.isGuest) { showToast('Registrate para publicar', 'info'); return; } startCamera(); });
            document.getElementById('camera-close')?.addEventListener('click', stopCamera);
            document.getElementById('camera-capture')?.addEventListener('click', () => { const canvas = document.getElementById('camera-canvas'); const ctx = canvas.getContext('2d'); canvas.width = cameraVideo.videoWidth; canvas.height = cameraVideo.videoHeight; ctx.drawImage(cameraVideo, 0, 0); canvas.toBlob((blob) => { AppState.capturedMedia = { blob, type: 'image' }; stopCamera(); openPostEditor(); }, 'image/jpeg', 0.9); });
            document.getElementById('camera-gallery-btn')?.addEventListener('click', () => document.getElementById('gallery-input')?.click());
            document.getElementById('gallery-input')?.addEventListener('change', (e) => { const file = e.target.files[0]; if (file) { AppState.capturedMedia = { blob: file, type: file.type.startsWith('video') ? 'video' : 'image' }; stopCamera(); openPostEditor(); } });
            function openPostEditor() { const modal = document.getElementById('post-editor-modal'); const img = document.getElementById('editor-preview-img'); const video = document.getElementById('editor-preview-video'); if (AppState.capturedMedia.type === 'video') { video.src = URL.createObjectURL(AppState.capturedMedia.blob); video.classList.remove('hidden'); img.classList.add('hidden'); } else { img.src = URL.createObjectURL(AppState.capturedMedia.blob); img.classList.remove('hidden'); video.classList.add('hidden'); } modal?.classList.add('active'); }
            document.getElementById('editor-cancel')?.addEventListener('click', () => { document.getElementById('post-editor-modal')?.classList.remove('active'); AppState.capturedMedia = null; });
            document.getElementById('editor-submit')?.addEventListener('click', async () => { if (AppState.isGuest) { showToast('Registrate para publicar', 'info'); return; } if (!AppState.capturedMedia) return; const caption = document.getElementById('editor-caption')?.value.trim(); document.getElementById('post-editor-modal')?.classList.remove('active'); showLoading('Subiendo...'); try { const fileName = `posts/${Date.now()}_${AppState.currentUser.uid}.jpg`; const storageRef = ref(storage, fileName); await uploadBytesResumable(storageRef, AppState.capturedMedia.blob); const downloadURL = await getDownloadURL(storageRef); await addDoc(collection(db, 'posts'), { userId: AppState.currentUser.uid, userName: AppState.userData?.name || 'Usuario', userPhoto: AppState.currentUser?.photoURL || '', mediaUrl: downloadURL, mediaType: AppState.capturedMedia.type, caption, likes: [], comments: [], createdAt: serverTimestamp() }); showToast('¬°Publicado!', 'success'); AppState.capturedMedia = null; } catch (error) { showToast('Error al subir', 'error'); } finally { hideLoading(); } });

            // CHAT
            document.getElementById('btn-send-chat')?.addEventListener('click', sendChatMessage);
            document.getElementById('chat-input')?.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendChatMessage(); });
            function sendChatMessage() { const input = document.getElementById('chat-input'); const msg = input?.value.trim(); if (!msg) return; const container = document.getElementById('chat-messages'); container.innerHTML += `<div class="chat-bubble user">${msg.replace(/</g, '&lt;')}</div>`; input.value = ''; container.scrollTop = container.scrollHeight; setTimeout(() => { const responses = ["Entiendo. Para mas informacion, contactanos al +56 9 1234 5678", "¬°Buena pregunta! Te sugiero visitar nuestra sede", "Perfecto, anotado. ¬øAlgo mas en lo que pueda ayudarte?", "Claro, te recomiendo agendar una cita"]; container.innerHTML += `<div class="chat-bubble bot">${responses[Math.floor(Math.random() * responses.length)]}</div>`; container.scrollTop = container.scrollHeight; }, 800); }

            showLoading('Iniciando...');
        });
    </script>
</body>
</html>
