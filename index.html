<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Maria's Cut</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F9F7F2">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="778405F5-FB9C-47F4-908A-185070ECD1DC.PNG">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#C5A059',
                        primaryDark: '#A88B45',
                        secondary: '#D4B896',
                        secondaryDark: '#B89C7A',
                        background: '#F9F7F2',
                        gold: '#D4AF37',
                        goldLight: '#E8D5A3',
                    },
                    fontFamily: {
                        sans: ['Quicksand', 'Poppins', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100dvh; overflow: hidden; font-family: 'Quicksand', 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif; background: #F9F7F2; touch-action: manipulation; }
        #app-container { width: 100%; height: 100%; position: relative; overflow: hidden; background: #F9F7F2; }
        .safe-header { padding-top: calc(env(safe-area-inset-top, 0px) + 10px); padding-bottom: 12px; background: #FFFDF5; border-bottom: 1px solid rgba(197, 160, 89, 0.15); position: sticky; top: 0; z-index: 50; flex-shrink: 0; }
        .header-gradient { background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%); padding-top: calc(env(safe-area-inset-top, 0px) + 12px); padding-bottom: 8px; position: sticky; top: 0; z-index: 10; }
        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; background: #F9F7F2; overflow: hidden; transition: opacity 0.3s ease; }
        .screen.hidden { opacity: 0; pointer-events: none; z-index: -1; }
        .screen.active { opacity: 1; pointer-events: auto; z-index: 1; }
        .screen-content { flex: 1; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 100px); }
        .login-screen { background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%); justify-content: center; padding: 24px; z-index: 100; }
        .login-logo { width: 100px; height: 100px; background: linear-gradient(135deg, #D4AF37 0%, #C5A059 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; box-shadow: 0 8px 32px rgba(212, 175, 55, 0.4); }
        .login-input { width: 100%; padding: 16px 20px; border-radius: 16px; border: 2px solid rgba(197, 160, 89, 0.3); background: white; font-size: 1rem; margin-bottom: 12px; outline: none; transition: all 0.3s ease; }
        .login-input:focus { border-color: #C5A059; box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.15); }
        .login-btn { width: 100%; padding: 16px; border-radius: 50px; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; font-weight: 600; font-size: 1rem; border: none; cursor: pointer; box-shadow: 0 4px 16px rgba(197, 160, 89, 0.4); transition: all 0.3s ease; margin-top: 8px; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(197, 160, 89, 0.5); }
        .login-btn-secondary { width: 100%; padding: 14px; border-radius: 50px; background: transparent; color: #4B3621; font-weight: 500; font-size: 0.95rem; border: 2px solid rgba(197, 160, 89, 0.4); cursor: pointer; transition: all 0.3s ease; margin-top: 12px; }
        .login-btn-secondary:hover { background: rgba(197, 160, 89, 0.1); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #FFFDF5; border-top: 1px solid rgba(197, 160, 89, 0.2); padding-bottom: env(safe-area-inset-bottom, 0px); z-index: 100; height: 80px; transition: transform 0.3s ease; }
        .bottom-nav.hidden { transform: translateY(100%); }
        .nav-container { display: flex; justify-content: space-around; align-items: flex-start; padding-top: 8px; position: relative; }
        .nav-item { display: flex; flex-direction: column; align-items: center; padding: 8px 12px; cursor: pointer; transition: color 0.2s ease; flex: 1; }
        .nav-item.active { color: #C5A059; }
        .nav-item:not(.active) { color: #8B7355; }
        .nav-center-btn { position: relative; top: -28px; width: 72px; height: 72px; border-radius: 50%; background: linear-gradient(135deg, #D4AF37 0%, #C5A059 50%, #B8941F 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 8px 32px rgba(212, 175, 55, 0.5), 0 4px 16px rgba(197, 160, 89, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.3); border: 3px solid #FFFDF5; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); flex-shrink: 0; z-index: 10; }
        .nav-center-btn:active { transform: scale(0.95); }
        .nav-center-label { position: absolute; bottom: -22px; font-size: 0.7rem; font-weight: 600; color: #C5A059; white-space: nowrap; }
        .stories-rail { display: flex; overflow-x: auto; gap: 12px; padding: 12px 16px; background: #FFFDF5; border-bottom: 1px solid rgba(197, 160, 89, 0.1); }
        .stories-rail::-webkit-scrollbar { display: none; }
        .story-item { display: flex; flex-direction: column; align-items: center; flex-shrink: 0; cursor: pointer; }
        .story-avatar-ring { width: 64px; height: 64px; border-radius: 50%; padding: 3px; background: linear-gradient(45deg, #F0EAD6, #C5A059, #D4B896); }
        .story-avatar-ring.unseen { background: linear-gradient(45deg, #D4AF37, #C5A059, #D4B896); animation: pulse-ring 2s infinite; }
        @keyframes pulse-ring { 0%, 100% { box-shadow: 0 0 0 0 rgba(197, 160, 89, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(197, 160, 89, 0); } }
        .story-avatar { width: 100%; height: 100%; border-radius: 50%; border: 3px solid #FFFDF5; object-fit: cover; }
        .camera-overlay { position: fixed; inset: 0; background: black; z-index: 500; display: none; flex-direction: column; }
        .camera-overlay.active { display: flex; }
        .camera-preview { flex: 1; position: relative; overflow: hidden; }
        .camera-video { width: 100%; height: 100%; object-fit: cover; }
        .camera-canvas { display: none; }
        .camera-controls { position: absolute; bottom: 40px; left: 0; right: 0; display: flex; justify-content: center; align-items: center; gap: 40px; padding: 0 24px; }
        .camera-btn-capture { width: 80px; height: 80px; border-radius: 50%; background: white; border: 4px solid rgba(255, 255, 255, 0.3); cursor: pointer; position: relative; transition: transform 0.1s; }
        .camera-btn-capture:active { transform: scale(0.9); }
        .camera-btn-capture::after { content: ''; position: absolute; inset: 4px; border-radius: 50%; background: white; border: 2px solid #C5A059; }
        .camera-btn-gallery { width: 50px; height: 50px; border-radius: 8px; overflow: hidden; cursor: pointer; border: 2px solid white; }
        .camera-btn-gallery img { width: 100%; height: 100%; object-fit: cover; }
        .camera-btn-close { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 20px); right: 20px; width: 44px; height: 44px; border-radius: 50%; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; }
        .camera-mode-switch { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 20px); left: 50%; transform: translateX(-50%); display: flex; gap: 16px; background: rgba(0, 0, 0, 0.5); padding: 8px 16px; border-radius: 20px; }
        .camera-mode-btn { color: white; font-size: 14px; font-weight: 500; background: none; border: none; cursor: pointer; opacity: 0.6; }
        .camera-mode-btn.active { opacity: 1; }
        .post-editor-modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95); z-index: 600; display: none; flex-direction: column; }
        .post-editor-modal.active { display: flex; }
        .post-editor-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; padding-top: calc(env(safe-area-inset-top, 0px) + 16px); }
        .post-editor-preview { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .post-editor-preview img, .post-editor-preview video { max-width: 100%; max-height: 50vh; border-radius: 16px; object-fit: contain; }
        .post-editor-footer { padding: 20px; padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 20px); background: #1a1a1a; }
        .post-editor-input { width: 100%; background: #2a2a2a; border: none; border-radius: 12px; padding: 16px; color: white; font-size: 16px; resize: none; margin-bottom: 16px; }
        .post-editor-input::placeholder { color: #888; }
        .post-editor-submit { width: 100%; padding: 16px; border-radius: 50px; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; font-weight: 700; font-size: 16px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .story-canvas-editor { position: fixed; inset: 0; background: #000; z-index: 650; display: none; flex-direction: column; }
        .story-canvas-editor.active { display: flex; }
        .story-canvas-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; padding-top: calc(env(safe-area-inset-top, 0px) + 16px); background: rgba(0, 0, 0, 0.8); position: absolute; top: 0; left: 0; right: 0; z-index: 20; }
        .story-canvas-container { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; background: #000; }
        #story-canvas { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 100%; max-height: 100%; touch-action: none; }
        .story-canvas-tools { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.9); padding: 16px 20px; padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 20px); z-index: 20; }
        .story-tools-row { display: flex; justify-content: center; gap: 16px; margin-bottom: 12px; }
        .story-tool-btn { width: 48px; height: 48px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); border: 2px solid transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; }
        .story-tool-btn.active { background: rgba(197, 160, 89, 0.3); border-color: #C5A059; }
        .story-tool-btn svg { width: 24px; height: 24px; color: white; }
        .story-colors-row { display: flex; justify-content: center; gap: 12px; margin-bottom: 16px; }
        .story-color-btn { width: 32px; height: 32px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; transition: all 0.2s ease; }
        .story-color-btn.active { border-color: white; transform: scale(1.1); }
        .story-text-input-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 30; display: none; }
        .story-text-input-container.active { display: block; }
        .story-text-input { background: transparent; border: none; color: white; font-size: 32px; font-weight: 700; text-align: center; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); outline: none; min-width: 200px; padding: 8px; }
        .story-text-input::placeholder { color: rgba(255, 255, 255, 0.5); }
        .story-submit-btn { width: 100%; padding: 16px; border-radius: 50px; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; font-weight: 700; font-size: 16px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .story-brush-size { display: flex; justify-content: center; gap: 12px; margin-bottom: 12px; }
        .story-brush-btn { width: 28px; height: 28px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); border: 2px solid transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .story-brush-btn.active { border-color: #C5A059; }
        .story-brush-dot { background: white; border-radius: 50%; }
        .story-viewer { position: fixed; inset: 0; background: black; z-index: 700; display: none; flex-direction: column; }
        .story-viewer.active { display: flex; }
        .story-progress-container { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 12px); left: 12px; right: 12px; display: flex; gap: 4px; z-index: 10; }
        .story-progress-bar { flex: 1; height: 3px; background: rgba(255, 255, 255, 0.3); border-radius: 2px; overflow: hidden; }
        .story-progress-fill { height: 100%; background: white; width: 0%; transition: width 0.1s linear; }
        .story-progress-fill.active { animation: progress 10s linear forwards; }
        @keyframes progress { from { width: 0%; } to { width: 100%; } }
        .story-content { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .story-content img, .story-content video { width: 100%; height: 100%; object-fit: contain; }
        .story-nav { position: absolute; inset: 0; display: flex; }
        .story-nav-prev, .story-nav-next { flex: 1; cursor: pointer; }
        .story-header { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 30px); left: 16px; right: 16px; display: flex; align-items: center; gap: 12px; z-index: 10; }
        .story-avatar-small { width: 40px; height: 40px; border-radius: 50%; border: 2px solid white; object-fit: cover; }
        .story-user-info { color: white; text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5); }
        .story-close { position: absolute; top: calc(env(safe-area-inset-top, 0px) + 30px); right: 16px; width: 36px; height: 36px; border-radius: 50%; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; z-index: 10; }
        .social-card { background: #FFFDF5; border-radius: 24px; margin: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(75, 54, 33, 0.06); }
        .post-media { width: 100%; aspect-ratio: 1; object-fit: cover; }
        .chat-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
        .chat-bubble { max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 0.95rem; line-height: 1.4; animation: fadeInUp 0.3s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .chat-bubble.bot { align-self: flex-start; background: #FFFDF5; color: #4B3621; border: 1px solid rgba(197, 160, 89, 0.2); border-bottom-left-radius: 4px; }
        .chat-bubble.user { align-self: flex-end; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; border-bottom-right-radius: 4px; }
        .chat-input-area { padding: 12px 16px calc(env(safe-area-inset-bottom, 0px) + 80px); background: #FFFDF5; border-top: 1px solid rgba(197, 160, 89, 0.15); }
        .chat-input-wrapper { display: flex; align-items: center; gap: 10px; background: #F9F7F2; border-radius: 50px; padding: 4px 4px 4px 16px; border: 1px solid rgba(197, 160, 89, 0.2); }
        .chat-input { flex: 1; border: none; background: transparent; font-size: 0.95rem; color: #4B3621; outline: none; padding: 10px 0; }
        .chat-send-btn { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .product-card { background: #FFFDF5; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 12px rgba(75, 54, 33, 0.05); }
        .category-pill { padding: 8px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 500; white-space: nowrap; cursor: pointer; }
        .category-pill.active { background: #C5A059; color: white; }
        .category-pill:not(.active) { background: #FFFDF5; color: #6D5D4E; border: 1px solid rgba(197, 160, 89, 0.2); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .grooming-header { background: linear-gradient(135deg, #FFFDF5 0%, #F5EFE0 100%); border-bottom: 1px solid rgba(197, 160, 89, 0.2); }
        .announcement-card { background: #FFFDF5; border: 1px solid rgba(197, 160, 89, 0.25); border-radius: 16px; padding: 16px; margin-bottom: 12px; }
        .portfolio-ring { width: 72px; height: 72px; border-radius: 50%; padding: 3px; background: linear-gradient(135deg, #D4AF37, #C5A059, #D4B896); }
        .portfolio-avatar { width: 100%; height: 100%; border-radius: 50%; border: 3px solid #FFFDF5; object-fit: cover; }
        .cta-button { background: linear-gradient(135deg, #C5A059 0%, #D4B896 100%); color: white; padding: 12px 24px; border-radius: 50px; font-weight: 600; box-shadow: 0 4px 16px rgba(197, 160, 89, 0.4); transition: all 0.3s ease; border: none; cursor: pointer; }
        .cta-button-gold { background: linear-gradient(135deg, #D4AF37 0%, #C5A059 50%, #B8941F 100%); color: white; padding: 16px 32px; border-radius: 50px; font-weight: 700; font-size: 1.1rem; box-shadow: 0 8px 32px rgba(212, 175, 55, 0.5); transition: all 0.3s ease; border: none; cursor: pointer; width: 100%; }
        .profile-header { background: linear-gradient(135deg, #F0EAD6 0%, #D4B896 100%); padding-top: calc(env(safe-area-inset-top, 0px) + 20px); padding-bottom: 30px; }
        .loading-overlay { position: fixed; inset: 0; background: rgba(249, 247, 242, 0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .loading-overlay.active { display: flex; }
        .loading-spinner { width: 48px; height: 48px; border: 4px solid #F0EAD6; border-top: 4px solid #C5A059; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(100px); background: #333; color: white; padding: 12px 24px; border-radius: 25px; font-size: 14px; z-index: 2000; opacity: 0; transition: all 0.3s ease; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: #22c55e; }
        .toast.error { background: #ef4444; }
        .toast.info { background: #3b82f6; }
        .header-centered { display: flex; justify-content: center; align-items: center; position: relative; padding: 12px 16px; padding-top: calc(env(safe-area-inset-top, 0px) + 12px); }
        .header-centered .header-title { text-align: center; }
        .header-centered .header-actions { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); margin-top: calc(env(safe-area-inset-top, 0px) / 2); }
    </style>
</head>

<body>
    <div id="app-container">
        <!-- SCREEN: LOGIN -->
        <div id="screen-login" class="screen login-screen active">
            <div class="text-center mb-8">
                <div class="login-logo">
                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" />
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-[#4B3621] font-serif mb-2">Maria's Cut</h1>
                <p class="text-[#6D5D4E]">Peluqueria Canina Premium</p>
            </div>
            <div class="space-y-3">
                <input type="email" id="login-email" class="login-input" placeholder="Correo electronico">
                <input type="password" id="login-password" class="login-input" placeholder="Contrasena">
                <div id="register-fields" class="hidden space-y-3">
                    <input type="text" id="login-name" class="login-input" placeholder="Tu nombre">
                    <input type="text" id="login-pet" class="login-input" placeholder="Nombre de tu mascota">
                    <input type="tel" id="login-phone" class="login-input" placeholder="Telefono">
                </div>
                <div id="login-actions">
                    <button id="btn-login" class="login-btn">Iniciar Sesion</button>
                    <button id="btn-show-register" class="login-btn-secondary text-sm mt-2">No tienes cuenta? Registrate aqui</button>
                </div>
                <div id="register-actions" class="hidden">
                    <button id="btn-register" class="login-btn">Registrarse</button>
                    <button id="btn-show-login" class="login-btn-secondary text-sm mt-2">Ya tienes cuenta? Inicia Sesion</button>
                </div>
                <button id="btn-skip" class="text-[#8B7355] text-xs font-semibold mt-6 underline hover:text-[#4B3621] transition-colors">Entrar como Invitado</button>
            </div>
            <p id="login-error" class="text-red-600 text-sm text-center mt-4 hidden bg-white/80 p-2 rounded-lg"></p>
        </div>
    </div>

    <!-- SCREEN: HOME (SOCIAL CLUB) -->
    <div id="screen-home" class="screen hidden">
        <div class="header-gradient header-centered">
            <div class="header-title">
                <h1 class="text-lg font-bold text-[#4B3621]">Maria's Social Club</h1>
                <p class="text-xs text-[#C5A059] font-medium">Comunidad Exclusiva</p>
            </div>
            <div class="header-actions">
                <button id="btn-add-content" class="w-9 h-9 bg-white/50 rounded-full flex items-center justify-center hover:bg-white/70 transition-colors">
                    <svg class="w-5 h-5 text-[#4B3621]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="screen-content">
            <div class="stories-rail" id="stories-container"></div>
            <div id="feed-container"></div>
        </div>
    </div>

    <!-- SCREEN: SHOP -->
    <div id="screen-shop" class="screen hidden">
        <div class="safe-header px-4 flex justify-between items-center">
            <h1 class="text-lg font-bold text-[#4B3621]">Boutique Maria's Cut</h1>
            <div class="relative">
                <svg class="w-6 h-6 text-[#4B3621]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-[10px] rounded-full flex items-center justify-center font-bold">2</span>
            </div>
        </div>
        <div class="screen-content">
            <div class="px-4 py-3">
                <div class="relative">
                    <input type="text" placeholder="Buscar productos..." class="w-full bg-[#FFFDF5] border border-[rgba(197,160,89,0.2)] rounded-xl py-3 pl-10 pr-4 text-sm focus:outline-none focus:border-[#C5A059]">
                    <svg class="w-5 h-5 text-[#8B7355] absolute left-3 top-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>
            <div class="flex gap-2 px-4 pb-3 overflow-x-auto no-scrollbar">
                <button class="category-pill active">Todo</button>
                <button class="category-pill">Alimentacion</button>
                <button class="category-pill">Juguetes</button>
                <button class="category-pill">Higiene</button>
                <button class="category-pill">Accesorios</button>
            </div>
            <div class="grid grid-cols-2 gap-3 px-4 pb-4">
                <div class="product-card">
                    <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1589924691195-41432c84c161?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                    </div>
                    <div class="p-3">
                        <h3 class="text-sm font-medium text-[#4B3621]">Perrarina Premium</h3>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-[#C5A059] font-bold">$54.99</span>
                            <button class="w-7 h-7 bg-[#F0EAD6] rounded-full flex items-center justify-center text-[#4B3621]">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="product-card">
                    <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1576201836106-db1758fd1c97?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                    </div>
                    <div class="p-3">
                        <h3 class="text-sm font-medium text-[#4B3621]">Collar GPS</h3>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-[#C5A059] font-bold">$129.99</span>
                            <button class="w-7 h-7 bg-[#F0EAD6] rounded-full flex items-center justify-center text-[#4B3621]">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="product-card">
                    <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1541599540903-216a46ca1dc0?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                    </div>
                    <div class="p-3">
                        <h3 class="text-sm font-medium text-[#4B3621]">Juguete Resistente</h3>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-[#C5A059] font-bold">$24.50</span>
                            <button class="w-7 h-7 bg-[#F0EAD6] rounded-full flex items-center justify-center text-[#4B3621]">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="product-card">
                    <div class="aspect-square bg-[#F0EAD6] overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1516734212186-a967f81ad0d7?w=400&h=400&fit=crop" class="w-full h-full object-cover">
                    </div>
                    <div class="p-3">
                        <h3 class="text-sm font-medium text-[#4B3621]">Champu Organico</h3>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-[#C5A059] font-bold">$18.90</span>
                            <button class="w-7 h-7 bg-[#F0EAD6] rounded-full flex items-center justify-center text-[#4B3621]">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCREEN: GROOMING -->
    <div id="screen-grooming" class="screen hidden">
        <div class="safe-header grooming-header px-4 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold text-[#4B3621] font-serif">El Studio de Maria</h1>
                <p class="text-xs text-[#C5A059] font-medium">Peluqueria Canina Premium</p>
            </div>
            <button id="btn-booking" class="cta-button flex items-center gap-2 text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Agendar Cita
            </button>
        </div>
        <div class="screen-content">
            <div class="bg-white py-4">
                <div class="px-4 mb-3">
                    <h2 class="text-sm font-bold text-[#4B3621] uppercase tracking-wide">Trabajos Recientes</h2>
                </div>
                <div class="flex overflow-x-auto gap-4 px-4 pb-2 no-scrollbar">
                    <div class="flex flex-col items-center flex-shrink-0">
                        <div class="portfolio-ring"><img src="https://images.unsplash.com/photo-1518717758536-85ae29035b6d?w=200&h=200&fit=crop" class="portfolio-avatar"></div>
                        <span class="text-xs text-[#4B3621] mt-2 font-medium">Luna</span>
                    </div>
                    <div class="flex flex-col items-center flex-shrink-0">
                        <div class="portfolio-ring"><img src="https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=200&h=200&fit=crop" class="portfolio-avatar"></div>
                        <span class="text-xs text-[#4B3621] mt-2 font-medium">Max</span>
                    </div>
                    <div class="flex flex-col items-center flex-shrink-0">
                        <div class="portfolio-ring"><img src="https://images.unsplash.com/photo-1537151608828-ea2b11777ee8?w=200&h=200&fit=crop" class="portfolio-avatar"></div>
                        <span class="text-xs text-[#4B3621] mt-2 font-medium">Bella</span>
                    </div>
                    <div class="flex flex-col items-center flex-shrink-0">
                        <div class="portfolio-ring"><img src="https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?w=200&h=200&fit=crop" class="portfolio-avatar"></div>
                        <span class="text-xs text-[#4B3621] mt-2 font-medium">Rocky</span>
                    </div>
                </div>
            </div>
            <div class="px-4 py-6">
                <div class="flex items-center gap-2 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
                        </svg>
                    </div>
                    <h2 class="text-lg font-bold text-[#4B3621]">Avisos de Maria</h2>
                </div>
                <div class="announcement-card">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center flex-shrink-0"><span class="text-white font-bold text-sm">M</span></div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1"><span class="font-bold text-[#4B3621]">Maria</span><span class="text-xs text-[#8B7355]">- Hace 2 horas</span></div>
                            <p class="text-[#4B3621] text-sm leading-relaxed">üì¢ <span class="font-semibold">¬°Atencion!</span> La proxima semana tenemos <span class="text-[#C5A059] font-semibold">10% de descuento</span> en Banos Medicados. üêï‚ú®</p>
                        </div>
                    </div>
                </div>
                <div class="announcement-card">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center flex-shrink-0"><span class="text-white font-bold text-sm">M</span></div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1"><span class="font-bold text-[#4B3621]">Maria</span><span class="text-xs text-[#8B7355]">- Ayer</span></div>
                            <p class="text-[#4B3621] text-sm leading-relaxed">üöê Nuestra Furgoneta Luna estara en <span class="font-semibold">Las Condes</span> este viernes. ¬°Cupos limitados!</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-4 pb-6">
                <h2 class="text-sm font-bold text-[#4B3621] uppercase tracking-wide mb-4">Nuestros Servicios</h2>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white rounded-2xl p-4 border border-[rgba(197,160,89,0.2)]">
                        <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center mb-3">
                            <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" /></svg>
                        </div>
                        <h3 class="font-semibold text-[#4B3621] text-sm">Bano & Corte</h3>
                        <p class="text-xs text-[#8B7355] mt-1">Desde $35.000</p>
                    </div>
                    <div class="bg-white rounded-2xl p-4 border border-[rgba(197,160,89,0.2)]">
                        <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center mb-3">
                            <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>
                        </div>
                        <h3 class="font-semibold text-[#4B3621] text-sm">Spa Deluxe</h3>
                        <p class="text-xs text-[#8B7355] mt-1">Desde $55.000</p>
                    </div>
                    <div class="bg-white rounded-2xl p-4 border border-[rgba(197,160,89,0.2)]">
                        <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center mb-3">
                            <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0" /></svg>
                        </div>
                        <h3 class="font-semibold text-[#4B3621] text-sm">A Domicilio</h3>
                        <p class="text-xs text-[#8B7355] mt-1">Furgoneta VIP</p>
                    </div>
                    <div class="bg-white rounded-2xl p-4 border border-[rgba(197,160,89,0.2)]">
                        <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center mb-3">
                            <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                        </div>
                        <h3 class="font-semibold text-[#4B3621] text-sm">Tratamientos</h3>
                        <p class="text-xs text-[#8B7355] mt-1">Piel & Pelo</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCREEN: ASSISTANT -->
    <div id="screen-assistant" class="screen hidden">
        <div class="safe-header px-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-[#C5A059] to-[#D4B896] rounded-full flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-[#4B3621]">Asistente Maria's Cut</h1>
                    <p class="text-xs text-[#C5A059]">Experto en bienestar animal</p>
                </div>
            </div>
        </div>
        <div class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <div class="chat-bubble bot">Hola, soy la IA de Maria's Cut. ¬øEn que puedo ayudarte hoy con tu mascota? üêæ</div>
            </div>
            <div class="chat-input-area">
                <div class="chat-input-wrapper">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Escribe tu mensaje...">
                    <button id="btn-send-chat" class="chat-send-btn">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCREEN: PROFILE -->
    <div id="screen-profile" class="screen hidden">
        <div class="profile-header px-4">
            <div class="flex items-center gap-4">
                <div class="w-20 h-20 bg-white rounded-full p-1 shadow-lg overflow-hidden">
                    <img id="profile-avatar" src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop" class="w-full h-full rounded-full object-cover">
                </div>
                <div>
                    <h1 id="profile-name" class="text-xl font-bold text-[#4B3621]">Cargando...</h1>
                    <p id="profile-pet" class="text-sm text-[#8B7355]">...</p>
                    <div class="flex items-center gap-1 mt-1">
                        <svg class="w-4 h-4 text-[#C5A059]" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                        <span class="text-sm text-[#4B3621] font-medium">4.9 (128 resenas)</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="screen-content">
            <div class="flex justify-around py-4 bg-white border-b border-[rgba(197,160,89,0.15)]">
                <div class="text-center"><p class="text-xl font-bold text-[#C5A059]">1</p><p class="text-xs text-[#8B7355]">Mascota</p></div>
                <div class="text-center"><p class="text-xl font-bold text-[#C5A059]">0</p><p class="text-xs text-[#8B7355]">Citas</p></div>
                <div class="text-center"><p class="text-xl font-bold text-[#C5A059]">0</p><p class="text-xs text-[#8B7355]">Posts</p></div>
            </div>
            <div class="px-4 py-4 space-y-2">
                <div class="bg-white rounded-2xl p-4 flex items-center gap-4 border border-[rgba(197,160,89,0.15)]">
                    <div class="w-10 h-10 bg-[#F0EAD6] rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                    </div>
                    <div class="flex-1"><h3 class="font-semibold text-[#4B3621]">Mis Datos</h3><p class="text-xs text-[#8B7355]">Informacion personal</p></div>
                </div>
                <div class="bg-white rounded-2xl p-4 flex items-center gap-4 border border-[rgba(197,160,89,0.15)]" id="btn-logout">
                    <div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                    </div>
                    <div class="flex-1"><h3 class="font-semibold text-red-500">Cerrar Sesion</h3><p class="text-xs text-[#8B7355]">Salir de la cuenta</p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCREEN: BOOKING -->
    <div id="screen-booking" class="screen hidden">
        <div class="safe-header border-b border-gray-100 pb-4 px-5 flex items-center">
            <button id="btn-back-grooming" class="p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <h1 class="text-lg font-semibold text-gray-800 ml-2">Reserva en Local</h1>
        </div>
        <div class="screen-content px-5 pt-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Selecciona un servicio</h2>
            <div class="bg-white rounded-2xl shadow-md p-4 border-2 border-[#C5A059] cursor-pointer mb-6" id="select-spa">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-semibold text-gray-800 text-lg">Spa Deluxe</h3>
                        <p class="text-gray-500 text-sm mt-1">Hidromasaje + Aromaterapia</p>
                        <div class="flex items-center mt-2 text-gray-400 text-sm">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>90 min
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xl font-bold text-[#C5A059]">$55.000</p>
                        <span class="bg-[#C5A059]/10 text-[#C5A059] text-xs px-2 py-1 rounded-full font-bold">Popular</span>
                    </div>
                </div>
            </div>
            <button id="btn-continue-payment" class="btn-ripple w-full bg-[#C5A059] hover:bg-[#A88B45] text-white font-semibold py-4 rounded-2xl transition-colors shadow-lg">Continuar al Pago</button>
        </div>
    </div>

    <!-- SCREEN: PAYMENT -->
    <div id="screen-payment" class="screen hidden">
        <div class="safe-header border-b border-gray-100 pb-4 px-5 flex items-center">
            <button id="btn-back-booking" class="p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <h1 class="text-lg font-semibold text-gray-800 ml-2">Confirmar y Pagar</h1>
        </div>
        <div class="screen-content px-5 pt-6">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-16 h-16 bg-[#F0EAD6] rounded-xl flex items-center justify-center">
                        <svg class="w-8 h-8 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" /></svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-800 text-lg">Spa Deluxe</h3>
                        <p class="text-gray-500 text-sm">Servicio Premium</p>
                    </div>
                </div>
                <div class="border-t border-gray-100 pt-4">
                    <div class="flex justify-between mb-2"><span class="text-gray-600">Subtotal</span><span class="font-medium">$55.000</span></div>
                    <div class="flex justify-between mb-2"><span class="text-gray-600">IVA (19%)</span><span class="font-medium">$10.450</span></div>
                    <div class="flex justify-between pt-2 border-t border-gray-100"><span class="font-bold text-gray-800">Total</span><span class="font-bold text-[#C5A059] text-xl">$65.450</span></div>
                </div>
            </div>
            <button id="btn-stripe-pay" class="cta-button-gold flex items-center justify-center gap-3">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>
                Pagar Ahora y Confirmar
            </button>
        </div>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <nav id="bottom-nav" class="bottom-nav hidden">
        <div class="nav-container">
            <div class="nav-item" data-screen="screen-home">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" /></svg>
                <span class="text-xs mt-1">Club</span>
            </div>
            <div class="nav-item" data-screen="screen-shop">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                <span class="text-xs mt-1">Tienda</span>
            </div>
            <div class="nav-center-btn" data-screen="screen-grooming">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" /></svg>
                <span class="nav-center-label">Peluqueria</span>
            </div>
            <div class="nav-item" data-screen="screen-assistant">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                <span class="text-xs mt-1">Asistente</span>
            </div>
            <div class="nav-item" data-screen="screen-profile">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                <span class="text-xs mt-1">Perfil</span>
            </div>
        </div>
    </nav>

    <!-- CAMERA OVERLAY -->
    <div id="camera-overlay" class="camera-overlay">
        <div class="camera-preview">
            <video id="camera-video" class="camera-video" autoplay playsinline></video>
            <canvas id="camera-canvas" class="camera-canvas"></canvas>
            <button id="camera-close" class="camera-btn-close">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div class="camera-mode-switch">
                <button class="camera-mode-btn active" data-mode="story">Historia</button>
                <button class="camera-mode-btn" data-mode="post">Publicacion</button>
            </div>
        </div>
        <div class="camera-controls">
            <div class="camera-btn-gallery" id="camera-gallery-btn">
                <img src="https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=100&h=100&fit=crop" alt="Gallery">
            </div>
            <button id="camera-capture" class="camera-btn-capture"></button>
            <div style="width: 50px;"></div>
        </div>
    </div>

    <!-- POST EDITOR MODAL -->
    <div id="post-editor-modal" class="post-editor-modal">
        <div class="post-editor-header">
            <button id="editor-cancel" class="text-white font-medium">Cancelar</button>
            <span id="editor-title" class="text-white font-semibold">Nueva Publicacion</span>
            <div style="width: 60px;"></div>
        </div>
        <div class="post-editor-preview">
            <img id="editor-preview-img" src="" alt="Preview">
            <video id="editor-preview-video" class="hidden" controls></video>
        </div>
        <div class="post-editor-footer">
            <textarea id="editor-caption" class="post-editor-input" rows="2" placeholder="Escribe un pie de foto..."></textarea>
            <button id="editor-submit" class="post-editor-submit">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
                Dejar Huella
            </button>
        </div>
    </div>

    <!-- STORY CANVAS EDITOR -->
    <div id="story-canvas-editor" class="story-canvas-editor">
        <div class="story-canvas-header">
            <button id="story-editor-cancel" class="text-white font-medium">Cancelar</button>
            <span class="text-white font-semibold">Editar Historia</span>
            <button id="story-editor-done" class="text-[#C5A059] font-semibold">Listo</button>
        </div>
        <div class="story-canvas-container">
            <canvas id="story-canvas"></canvas>
        </div>
        <div id="story-text-input-container" class="story-text-input-container">
            <input type="text" id="story-text-input" class="story-text-input" placeholder="Escribe algo...">
        </div>
        <div class="story-canvas-tools">
            <div class="story-brush-size" id="brush-sizes">
                <button class="story-brush-btn" data-size="3"><div class="story-brush-dot" style="width: 6px; height: 6px;"></div></button>
                <button class="story-brush-btn active" data-size="6"><div class="story-brush-dot" style="width: 10px; height: 10px;"></div></button>
                <button class="story-brush-btn" data-size="12"><div class="story-brush-dot" style="width: 16px; height: 16px;"></div></button>
            </div>
            <div class="story-colors-row">
                <button class="story-color-btn active" data-color="#FFFFFF" style="background: #FFFFFF;"></button>
                <button class="story-color-btn" data-color="#FF0000" style="background: #FF0000;"></button>
                <button class="story-color-btn" data-color="#00FF00" style="background: #00FF00;"></button>
                <button class="story-color-btn" data-color="#0000FF" style="background: #0000FF;"></button>
                <button class="story-color-btn" data-color="#FFFF00" style="background: #FFFF00;"></button>
                <button class="story-color-btn" data-color="#FF00FF" style="background: #FF00FF;"></button>
                <button class="story-color-btn" data-color="#00FFFF" style="background: #00FFFF;"></button>
                <button class="story-color-btn" data-color="#000000" style="background: #000000;"></button>
            </div>
            <div class="story-tools-row">
                <button class="story-tool-btn active" data-tool="pen" title="Lapiz">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                </button>
                <button class="story-tool-btn" data-tool="text" title="Texto">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" /></svg>
                </button>
                <button class="story-tool-btn" data-tool="eraser" title="Borrador">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                </button>
                <button class="story-tool-btn" data-tool="undo" title="Deshacer">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" /></svg>
                </button>
            </div>
            <button id="story-submit" class="story-submit-btn">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                Subir Historia
            </button>
        </div>
    </div>

    <!-- STORY VIEWER -->
    <div id="story-viewer" class="story-viewer">
        <div class="story-progress-container" id="story-progress-container"></div>
        <div class="story-header">
            <img id="story-viewer-avatar" src="" class="story-avatar-small">
            <div class="story-user-info">
                <p id="story-viewer-name" class="font-semibold"></p>
                <p id="story-viewer-time" class="text-xs opacity-80"></p>
            </div>
        </div>
        <button id="story-close" class="story-close">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
        <div class="story-content">
            <img id="story-viewer-media" src="" class="hidden">
            <video id="story-viewer-video" class="hidden" autoplay></video>
        </div>
        <div class="story-nav">
            <div id="story-nav-prev" class="story-nav-prev"></div>
            <div id="story-nav-next" class="story-nav-next"></div>
        </div>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p id="loading-text" class="mt-4 text-[#4B3621] font-medium">Cargando...</p>
    </div>

    <!-- TOAST -->
    <div id="toast" class="toast"></div>

    <!-- Hidden file input for gallery -->
    <input type="file" id="gallery-input" class="hidden" accept="image/*,video/*">
    </div>

    <!-- FIREBASE & APP LOGIC -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInAnonymously, signOut, updateProfile } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBTJ1Gf__zEpi9SkA1LkJ8pYz4Jb0zkU8A",
            authDomain: "maria-s-cut.firebaseapp.com",
            projectId: "maria-s-cut",
            storageBucket: "maria-s-cut.firebasestorage.app",
            messagingSenderId: "387590858198",
            appId: "1:387590858198:web:0848e746b595543f0af077",
            measurementId: "G-CW33W93S9Y"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        const AppState = {
            currentUser: null,
            userData: null,
            isGuest: false,
            currentScreen: 'login',
            cameraMode: 'story',
            capturedMedia: null,
            stories: [],
            currentStoryIndex: 0,
            storyTimer: null,
            mediaStream: null,
            isInitializing: true
        };

        const CanvasState = {
            canvas: null,
            ctx: null,
            isDrawing: false,
            currentTool: 'pen',
            currentColor: '#FFFFFF',
            currentSize: 6,
            drawingHistory: [],
            historyStep: -1,
            backgroundImage: null,
            textElements: [],
            isAddingText: false
        };

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
                s.classList.add('hidden');
            });
            const screen = document.getElementById(screenId);
            if (screen) {
                screen.classList.remove('hidden');
                screen.classList.add('active');
            }
            AppState.currentScreen = screenId;
            updateNavState();
        }

        function updateNavState() {
            const navItems = document.querySelectorAll('.nav-item, .nav-center-btn');
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.dataset.screen === AppState.currentScreen) {
                    item.classList.add('active');
                }
            });
        }

        function showLoading(text = 'Cargando...') {
            document.getElementById('loading-text').textContent = text;
            document.getElementById('loading-overlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.remove('active');
        }

        function showToast(message, type = 'default') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        onAuthStateChanged(auth, async (user) => {
            const nav = document.getElementById('bottom-nav');
            if (AppState.isInitializing) {
                showLoading('Iniciando aplicacion...');
            }
            try {
                if (!user && !AppState.isGuest) {
                    AppState.currentUser = null;
                    AppState.userData = null;
                    showScreen('screen-login');
                    nav.classList.add('hidden');
                } else {
                    AppState.currentUser = user;
                    if (user && !AppState.isGuest) {
                        await loadUserData(user.uid);
                    } else {
                        AppState.userData = { name: 'Invitado', petName: '' };
                    }
                    showScreen('screen-grooming');
                    nav.classList.remove('hidden');
                    loadFeed();
                    loadStories();
                }
            } catch (error) {
                console.error('Error en onAuthStateChanged:', error);
                showToast('Error al cargar la aplicacion');
                showScreen('screen-login');
                nav.classList.add('hidden');
            } finally {
                hideLoading();
                AppState.isInitializing = false;
            }
        });

        async function loadUserData(uid) {
            if (!uid) return false;
            try {
                const userDoc = await getDoc(doc(db, 'users', uid));
                if (userDoc.exists()) {
                    AppState.userData = userDoc.data();
                    document.getElementById('profile-name').textContent = AppState.userData.name || 'Usuario';
                    document.getElementById('profile-pet').textContent = AppState.userData.petName ? 'üêï ' + AppState.userData.petName : '';
                    if (AppState.currentUser?.photoURL) {
                        document.getElementById('profile-avatar').src = AppState.currentUser.photoURL;
                    }
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error loading user data:', error);
                return false;
            }
        }

        const loginActions = document.getElementById('login-actions');
        const registerActions = document.getElementById('register-actions');
        const registerFields = document.getElementById('register-fields');
        const errorEl = document.getElementById('login-error');

        document.getElementById('btn-show-register').addEventListener('click', () => {
            loginActions.classList.add('hidden');
            registerActions.classList.remove('hidden');
            registerFields.classList.remove('hidden');
            errorEl.classList.add('hidden');
        });

        document.getElementById('btn-show-login').addEventListener('click', () => {
            registerActions.classList.add('hidden');
            loginActions.classList.remove('hidden');
            registerFields.classList.add('hidden');
            errorEl.classList.add('hidden');
        });

        document.getElementById('btn-login').addEventListener('click', async () => {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            if (!email || !password) {
                showError('Ingresa tu email y contrasena');
                return;
            }
            showLoading('Iniciando sesion...');
            hideError();
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password') {
                    showError('Usuario o contrasena incorrectos');
                } else if (error.code === 'auth/too-many-requests') {
                    showError('Demasiados intentos. Espera un momento.');
                } else if (error.code === 'auth/invalid-email') {
                    showError('El correo electronico no es valido');
                } else if (error.code === 'auth/user-disabled') {
                    showError('Esta cuenta ha sido deshabilitada');
                } else {
                    showError('Error al entrar: ' + error.message);
                }
            } finally {
                hideLoading();
            }
        });

        document.getElementById('btn-register').addEventListener('click', async () => {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const name = document.getElementById('login-name').value.trim();
            const pet = document.getElementById('login-pet').value.trim();
            const phone = document.getElementById('login-phone').value.trim();
            if (!email || !password || !name) {
                showError('Email, contrasena y nombre son obligatorios');
                return;
            }
            if (password.length < 6) {
                showError('La contrasena debe tener al menos 6 caracteres');
                return;
            }
            showLoading('Creando cuenta...');
            hideError();
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, 'users', userCredential.user.uid), {
                    name: name,
                    email: email,
                    petName: pet || 'Mi Mascota',
                    phone: phone || '',
                    createdAt: serverTimestamp()
                });
                await updateProfile(userCredential.user, { displayName: name });
                AppState.userData = { name: name, email: email, petName: pet || 'Mi Mascota', phone: phone || '' };
                showToast('Cuenta creada exitosamente!', 'success');
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    showError('Este correo ya esta registrado. Intenta iniciar sesion.');
                } else if (error.code === 'auth/weak-password') {
                    showError('La contrasena es muy debil. Usa al menos 6 caracteres.');
                } else if (error.code === 'auth/invalid-email') {
                    showError('El correo electronico no es valido');
                } else {
                    showError('Error al registrar: ' + error.message);
                }
            } finally {
                hideLoading();
            }
        });

        function showError(msg) {
            errorEl.textContent = msg;
            errorEl.classList.remove('hidden');
        }

        function hideError() {
            errorEl.classList.add('hidden');
        }

        document.getElementById('btn-skip').addEventListener('click', async () => {
            showLoading('Entrando como invitado...');
            try {
                AppState.isGuest = true;
                await signInAnonymously(auth);
            } catch (error) {
                console.error('Guest login error:', error);
                hideLoading();
                showToast('Error al entrar como invitado', 'error');
                AppState.isGuest = false;
            }
        });

        document.getElementById('btn-logout').addEventListener('click', async () => {
            try {
                await signOut(auth);
                AppState.isGuest = false;
                AppState.currentUser = null;
                AppState.userData = null;
            } catch (error) {
                showToast('Error al cerrar sesion', 'error');
            }
        });

        document.querySelectorAll('.nav-item, .nav-center-btn').forEach(item => {
            item.addEventListener('click', () => {
                const screenId = item.dataset.screen;
                if (screenId) showScreen(screenId);
            });
        });

        const cameraOverlay = document.getElementById('camera-overlay');
        const cameraVideo = document.getElementById('camera-video');
        const cameraCanvas = document.getElementById('camera-canvas');

        async function startCamera() {
            if (AppState.isGuest) {
                showToast('Registrate para publicar contenido', 'info');
                return;
            }
            try {
                AppState.mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' },
                    audio: false
                });
                cameraVideo.srcObject = AppState.mediaStream;
                cameraOverlay.classList.add('active');
            } catch (error) {
                console.error('Camera error:', error);
                showToast('No se pudo acceder a la camara', 'error');
                document.getElementById('gallery-input').click();
            }
        }

        function stopCamera() {
            if (AppState.mediaStream) {
                AppState.mediaStream.getTracks().forEach(track => track.stop());
                AppState.mediaStream = null;
            }
            cameraOverlay.classList.remove('active');
        }

        document.getElementById('btn-add-content').addEventListener('click', () => {
            if (AppState.isGuest) {
                showToast('Registrate para publicar contenido', 'info');
                return;
            }
            AppState.cameraMode = 'post';
            updateCameraModeUI();
            startCamera();
        });

        function updateCameraModeUI() {
            document.querySelectorAll('.camera-mode-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mode === AppState.cameraMode) {
                    btn.classList.add('active');
                }
            });
        }

        document.getElementById('camera-close').addEventListener('click', stopCamera);

        document.querySelectorAll('.camera-mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.camera-mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                AppState.cameraMode = btn.dataset.mode;
            });
        });

        document.getElementById('camera-capture').addEventListener('click', () => {
            const context = cameraCanvas.getContext('2d');
            cameraCanvas.width = cameraVideo.videoWidth;
            cameraCanvas.height = cameraVideo.videoHeight;
            context.drawImage(cameraVideo, 0, 0);
            cameraCanvas.toBlob((blob) => {
                AppState.capturedMedia = { blob, type: 'image' };
                stopCamera();
                if (AppState.cameraMode === 'story') {
                    openStoryCanvasEditor();
                } else {
                    openPostEditor();
                }
            }, 'image/jpeg', 0.9);
        });

        document.getElementById('camera-gallery-btn').addEventListener('click', () => {
            document.getElementById('gallery-input').click();
        });

        document.getElementById('gallery-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                AppState.capturedMedia = {
                    blob: file,
                    type: file.type.startsWith('video') ? 'video' : 'image'
                };
                stopCamera();
                if (AppState.cameraMode === 'story') {
                    openStoryCanvasEditor();
                } else {
                    openPostEditor();
                }
            }
        });

        function openStoryCanvasEditor() {
            if (AppState.isGuest) {
                showToast('Registrate para publicar contenido', 'info');
                return;
            }
            const modal = document.getElementById('story-canvas-editor');
            const canvas = document.getElementById('story-canvas');
            CanvasState.canvas = canvas;
            CanvasState.ctx = canvas.getContext('2d');
            CanvasState.drawingHistory = [];
            CanvasState.historyStep = -1;
            CanvasState.textElements = [];
            const img = new Image();
            img.onload = () => {
                CanvasState.backgroundImage = img;
                const maxWidth = window.innerWidth;
                const maxHeight = window.innerHeight * 0.65;
                const scale = Math.min(maxWidth / img.width, maxHeight / img.height);
                canvas.width = img.width;
                canvas.height = img.height;
                canvas.style.width = (img.width * scale) + 'px';
                canvas.style.height = (img.height * scale) + 'px';
                redrawCanvas();
            };
            img.src = URL.createObjectURL(AppState.capturedMedia.blob);
            modal.classList.add('active');
            setupCanvasEvents();
        }

        function setupCanvasEvents() {
            const canvas = CanvasState.canvas;
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd);
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseUp);
        }

        function getCanvasCoordinates(e) {
            const canvas = CanvasState.canvas;
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            let clientX, clientY;
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        function handleTouchStart(e) {
            if (CanvasState.currentTool === 'text') return;
            e.preventDefault();
            CanvasState.isDrawing = true;
            const coords = getCanvasCoordinates(e);
            CanvasState.lastX = coords.x;
            CanvasState.lastY = coords.y;
        }

        function handleTouchMove(e) {
            if (!CanvasState.isDrawing || CanvasState.currentTool === 'text') return;
            e.preventDefault();
            const coords = getCanvasCoordinates(e);
            draw(coords.x, coords.y);
        }

        function handleTouchEnd(e) {
            if (CanvasState.isDrawing) {
                CanvasState.isDrawing = false;
                saveDrawingState();
            }
        }

        function handleMouseDown(e) {
            if (CanvasState.currentTool === 'text') return;
            CanvasState.isDrawing = true;
            const coords = getCanvasCoordinates(e);
            CanvasState.lastX = coords.x;
            CanvasState.lastY = coords.y;
        }

        function handleMouseMove(e) {
            if (!CanvasState.isDrawing || CanvasState.currentTool === 'text') return;
            const coords = getCanvasCoordinates(e);
            draw(coords.x, coords.y);
        }

        function handleMouseUp(e) {
            if (CanvasState.isDrawing) {
                CanvasState.isDrawing = false;
                saveDrawingState();
            }
        }

        function draw(x, y) {
            const ctx = CanvasState.ctx;
            ctx.lineWidth = CanvasState.currentSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            if (CanvasState.currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
            } else {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = CanvasState.currentColor;
            }
            ctx.beginPath();
            ctx.moveTo(CanvasState.lastX, CanvasState.lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            CanvasState.lastX = x;
            CanvasState.lastY = y;
        }

        function saveDrawingState() {
            CanvasState.historyStep++;
            if (CanvasState.historyStep < CanvasState.drawingHistory.length) {
                CanvasState.drawingHistory.length = CanvasState.historyStep;
            }
            CanvasState.drawingHistory.push(CanvasState.canvas.toDataURL());
        }

        function undo() {
            if (CanvasState.historyStep > 0) {
                CanvasState.historyStep--;
                const img = new Image();
                img.onload = () => {
                    CanvasState.ctx.clearRect(0, 0, CanvasState.canvas.width, CanvasState.canvas.height);
                    CanvasState.ctx.drawImage(img, 0, 0);
                };
                img.src = CanvasState.drawingHistory[CanvasState.historyStep];
            } else if (CanvasState.historyStep === 0) {
                CanvasState.historyStep = -1;
                redrawCanvas(true);
            }
        }

        function redrawCanvas(clearOnly = false) {
            const canvas = CanvasState.canvas;
            const ctx = CanvasState.ctx;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (!clearOnly && CanvasState.backgroundImage) {
                ctx.drawImage(CanvasState.backgroundImage, 0, 0);
            }
        }

        document.querySelectorAll('.story-tool-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tool = btn.dataset.tool;
                if (tool === 'undo') {
                    undo();
                    return;
                }
                CanvasState.currentTool = tool;
                document.querySelectorAll('.story-tool-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                if (tool === 'text') {
                    showTextInput();
                } else {
                    hideTextInput();
                }
            });
        });

        document.querySelectorAll('.story-color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                CanvasState.currentColor = btn.dataset.color;
                document.querySelectorAll('.story-color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        document.querySelectorAll('.story-brush-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                CanvasState.currentSize = parseInt(btn.dataset.size);
                document.querySelectorAll('.story-brush-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        function showTextInput() {
            const container = document.getElementById('story-text-input-container');
            const input = document.getElementById('story-text-input');
            container.classList.add('active');
            input.value = '';
            input.focus();
            CanvasState.isAddingText = true;
        }

        function hideTextInput() {
            const container = document.getElementById('story-text-input-container');
            container.classList.remove('active');
            CanvasState.isAddingText = false;
        }

        document.getElementById('story-text-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const text = e.target.value.trim();
                if (text) addTextToCanvas(text);
                hideTextInput();
                CanvasState.currentTool = 'pen';
                document.querySelectorAll('.story-tool-btn').forEach(b => b.classList.remove('active'));
                document.querySelector('[data-tool="pen"]').classList.add('active');
            }
        });

        function addTextToCanvas(text) {
            const ctx = CanvasState.ctx;
            const canvas = CanvasState.canvas;
            ctx.save();
            ctx.font = 'bold 48px sans-serif';
            ctx.fillStyle = CanvasState.currentColor;
            ctx.textAlign = 'center';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
            ctx.shadowBlur = 4;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            ctx.restore();
            saveDrawingState();
        }

        document.getElementById('story-editor-cancel').addEventListener('click', () => {
            document.getElementById('story-canvas-editor').classList.remove('active');
            AppState.capturedMedia = null;
        });

        document.getElementById('story-editor-done').addEventListener('click', () => {
            hideTextInput();
        });

        function openPostEditor() {
            if (AppState.isGuest) {
                showToast('Registrate para publicar contenido', 'info');
                return;
            }
            const modal = document.getElementById('post-editor-modal');
            const previewImg = document.getElementById('editor-preview-img');
            const previewVideo = document.getElementById('editor-preview-video');
            const title = document.getElementById('editor-title');
            const caption = document.getElementById('editor-caption');
            title.textContent = 'Nueva Publicacion';
            caption.value = '';
            if (AppState.capturedMedia.type === 'image') {
                previewImg.classList.remove('hidden');
                previewVideo.classList.add('hidden');
                previewImg.src = URL.createObjectURL(AppState.capturedMedia.blob);
            } else {
                previewImg.classList.add('hidden');
                previewVideo.classList.remove('hidden');
                previewVideo.src = URL.createObjectURL(AppState.capturedMedia.blob);
            }
            modal.classList.add('active');
        }

        document.getElementById('editor-cancel').addEventListener('click', () => {
            document.getElementById('post-editor-modal').classList.remove('active');
            AppState.capturedMedia = null;
        });

        document.getElementById('story-submit').addEventListener('click', async () => {
            if (AppState.isGuest) {
                showToast('Registrate para publicar contenido', 'info');
                return;
            }
            document.getElementById('story-canvas-editor').classList.remove('active');
            showToast('Subiendo...', 'info');
            try {
                const mergedBlob = await mergeCanvasToImage();
                const fileName = 'stories/' + Date.now() + '_' + (AppState.currentUser?.uid || 'guest') + '.jpg';
                const storageRef = ref(storage, fileName);
                const uploadTask = uploadBytesResumable(storageRef, mergedBlob);
                await new Promise((resolve, reject) => {
                    uploadTask.on('state_changed', null, (error) => reject(error), () => resolve());
                });
                const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                await addDoc(collection(db, 'stories'), {
                    userId: AppState.currentUser?.uid,
                    userName: AppState.userData?.name || 'Usuario',
                    userPhoto: AppState.currentUser?.photoURL || '',
                    mediaUrl: downloadURL,
                    mediaType: 'image',
                    createdAt: serverTimestamp(),
                    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000)
                });
                showToast('Historia publicada!', 'success');
                AppState.capturedMedia = null;
            } catch (error) {
                console.error('Upload error:', error);
                showToast('Error al subir. Toca para reintentar.', 'error');
            }
        });

        async function mergeCanvasToImage() {
            const canvas = CanvasState.canvas;
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            if (CanvasState.backgroundImage) {
                tempCtx.drawImage(CanvasState.backgroundImage, 0, 0);
            }
            tempCtx.drawImage(canvas, 0, 0);
            return new Promise((resolve) => {
                tempCanvas.toBlob((blob) => resolve(blob), 'image/jpeg', 0.95);
            });
        }

        document.getElementById('editor-submit').addEventListener('click', async () => {
            if (AppState.isGuest) {
                showToast('Registrate para publicar contenido', 'info');
                return;
            }
            const caption = document.getElementById('editor-caption').value.trim();
            document.getElementById('post-editor-modal').classList.remove('active');
            showToast('Subiendo...', 'info');
            try {
                const fileName = 'posts/' + Date.now() + '_' + (AppState.currentUser?.uid || 'guest') + '.jpg';
                const storageRef = ref(storage, fileName);
                const uploadTask = uploadBytesResumable(storageRef, AppState.capturedMedia.blob);
                await new Promise((resolve, reject) => {
                    uploadTask.on('state_changed', null, (error) => reject(error), () => resolve());
                });
                const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                await addDoc(collection(db, 'posts'), {
                    userId: AppState.currentUser?.uid,
                    userName: AppState.userData?.name || 'Usuario',
                    userPhoto: AppState.currentUser?.photoURL || '',
                    mediaUrl: downloadURL,
                    mediaType: AppState.capturedMedia.type,
                    caption: caption || 'üêæ',
                    likes: 0,
                    createdAt: serverTimestamp()
                });
                showToast('Publicacion creada!', 'success');
                AppState.capturedMedia = null;
            } catch (error) {
                console.error('Upload error:', error);
                showToast('Error al subir. Toca para reintentar.', 'error');
            }
        });

        function loadFeed() {
            const feedContainer = document.getElementById('feed-container');
            const postsQuery = query(collection(db, 'posts'), orderBy('createdAt', 'desc'));
            onSnapshot(postsQuery, (snapshot) => {
                let html = '';
                snapshot.forEach((doc) => {
                    const post = doc.data();
                    html += '<div class="social-card"><div class="flex items-center p-3"><img src="' + (post.userPhoto || 'https://randomuser.me/api/portraits/lego/1.jpg') + '" class="w-8 h-8 rounded-full object-cover mr-2"><div><h4 class="text-sm font-bold text-[#4B3621]">' + post.userName + '</h4></div></div>';
                    if (post.mediaType === 'video') {
                        html += '<video src="' + post.mediaUrl + '" class="post-media" controls></video>';
                    } else {
                        html += '<img src="' + post.mediaUrl + '" class="post-media">';
                    }
                    html += '<div class="p-3"><p class="text-sm text-[#4B3621]"><span class="font-bold">' + post.userName + '</span> ' + post.caption + '</p></div></div>';
                });
                feedContainer.innerHTML = html;
            }, (error) => {
                console.error('Feed error:', error);
            });
        }

        function loadStories() {
            const storiesContainer = document.getElementById('stories-container');
            const storiesQuery = query(collection(db, 'stories'), orderBy('createdAt', 'desc'));
            onSnapshot(storiesQuery, (snapshot) => {
                AppState.stories = [];
                let html = '<div class="story-item" id="btn-add-story"><div class="story-avatar-ring" style="background: transparent; border: 2px dashed #C5A059;"><div class="w-full h-full bg-white rounded-full flex items-center justify-center"><svg class="w-6 h-6 text-[#C5A059]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg></div></div><span class="text-xs text-[#6D5D4E] mt-1">Tu Historia</span></div>';
                snapshot.forEach((doc) => {
                    const story = { id: doc.id, ...doc.data() };
                    AppState.stories.push(story);
                    html += '<div class="story-item" data-story-id="' + story.id + '"><div class="story-avatar-ring unseen"><img src="' + story.mediaUrl + '" class="story-avatar"></div><span class="text-xs text-[#4B3621] mt-1 font-medium">' + story.userName + '</span></div>';
                });
                storiesContainer.innerHTML = html;
                document.getElementById('btn-add-story').addEventListener('click', () => {
                    if (AppState.isGuest) {
                        showToast('Registrate para publicar contenido', 'info');
                        return;
                    }
                    AppState.cameraMode = 'story';
                    updateCameraModeUI();
                    startCamera();
                });
                document.querySelectorAll('.story-item[data-story-id]').forEach(item => {
                    item.addEventListener('click', () => {
                        const storyId = item.dataset.storyId;
                        const index = AppState.stories.findIndex(s => s.id === storyId);
                        if (index !== -1) openStoryViewer(index);
                    });
                });
            }, (error) => {
                console.error('Stories error:', error);
            });
        }

        function openStoryViewer(startIndex = 0) {
            if (AppState.stories.length === 0) return;
            AppState.currentStoryIndex = startIndex;
            const viewer = document.getElementById('story-viewer');
            viewer.classList.add('active');
            const progressContainer = document.getElementById('story-progress-container');
            progressContainer.innerHTML = AppState.stories.map((_, i) => '<div class="story-progress-bar"><div class="story-progress-fill ' + (i === startIndex ? 'active' : '') + '" id="progress-' + i + '"></div></div>').join('');
            showCurrentStory();
        }

        function showCurrentStory() {
            const story = AppState.stories[AppState.currentStoryIndex];
            if (!story) {
                closeStoryViewer();
                return;
            }
            AppState.stories.forEach((_, i) => {
                const fill = document.getElementById('progress-' + i);
                if (fill) {
                    fill.classList.remove('active');
                    fill.style.width = i < AppState.currentStoryIndex ? '100%' : '0%';
                }
            });
            const currentFill = document.getElementById('progress-' + AppState.currentStoryIndex);
            if (currentFill) currentFill.classList.add('active');
            document.getElementById('story-viewer-name').textContent = story.userName;
            document.getElementById('story-viewer-avatar').src = story.userPhoto || 'https://randomuser.me/api/portraits/lego/1.jpg';
            const mediaImg = document.getElementById('story-viewer-media');
            const mediaVideo = document.getElementById('story-viewer-video');
            if (story.mediaType === 'video') {
                mediaImg.classList.add('hidden');
                mediaVideo.classList.remove('hidden');
                mediaVideo.src = story.mediaUrl;
                mediaVideo.play();
            } else {
                mediaVideo.classList.add('hidden');
                mediaImg.classList.remove('hidden');
                mediaImg.src = story.mediaUrl;
            }
            clearTimeout(AppState.storyTimer);
            AppState.storyTimer = setTimeout(() => nextStory(), 10000);
        }

        function nextStory() {
            if (AppState.currentStoryIndex < AppState.stories.length - 1) {
                AppState.currentStoryIndex++;
                showCurrentStory();
            } else {
                closeStoryViewer();
            }
        }

        function prevStory() {
            if (AppState.currentStoryIndex > 0) {
                AppState.currentStoryIndex--;
                showCurrentStory();
            }
        }

        function closeStoryViewer() {
            clearTimeout(AppState.storyTimer);
            document.getElementById('story-viewer').classList.remove('active');
            document.getElementById('story-viewer-video').pause();
        }

        document.getElementById('story-close').addEventListener('click', closeStoryViewer);
        document.getElementById('story-nav-next').addEventListener('click', nextStory);
        document.getElementById('story-nav-prev').addEventListener('click', prevStory);

        document.getElementById('btn-send-chat').addEventListener('click', sendChatMessage);
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if (!msg) return;
            const container = document.getElementById('chat-messages');
            container.innerHTML += '<div class="chat-bubble user">' + msg + '</div>';
            input.value = '';
            container.scrollTop = container.scrollHeight;
            setTimeout(() => {
                const responses = [
                    "Entiendo. Para mas informacion, contactanos al +56 9 1234 5678 üìû",
                    "Buena pregunta! Te sugiero visitar nuestra sede en Av. Providencia 1234 üìç",
                    "Perfecto, anotado. Algo mas en lo que pueda ayudarte?",
                    "Claro, te recomiendo agendar una cita para que tu mascota reciba la mejor atencion ‚ú®"
                ];
                const resp = responses[Math.floor(Math.random() * responses.length)];
                container.innerHTML += '<div class="chat-bubble bot">' + resp + '</div>';
                container.scrollTop = container.scrollHeight;
            }, 800);
        }

        document.getElementById('btn-booking').addEventListener('click', () => showScreen('screen-booking'));
        document.getElementById('btn-continue-payment').addEventListener('click', () => showScreen('screen-payment'));
        document.getElementById('btn-stripe-pay').addEventListener('click', () => {
            window.open('https://buy.stripe.com/14A8wH1Yjd6E0The7Adby00', '_blank');
        });

        console.log('Maria\'s Cut App initialized - CANVAS EDITION');
    </script>
</body>
</html>
